<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Topic Publisher</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for Typography and Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Hide Date Input Icon but keep functionality */
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900 overflow-x-hidden">

    <!-- App Container -->
    <div id="app">
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 z-[60] flex items-center justify-center bg-white">
            <div class="loader"></div>
        </div>

        <!-- ================= SIDE MENU (DRAWER) ================= -->
        <div id="menu-overlay" class="fixed inset-0 z-50 bg-slate-900/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300"></div>
        
        <div id="menu-drawer" class="fixed inset-y-0 left-0 z-50 w-72 transform -translate-x-full bg-white shadow-2xl transition-transform duration-300 ease-in-out flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between border-b border-slate-100 p-5">
                <div class="flex items-center space-x-2">
                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-600 text-white">
                        <i data-lucide="book-open" class="h-5 w-5"></i>
                    </div>
                    <span class="text-lg font-bold text-slate-800">Menu</span>
                </div>
                <button id="close-menu-btn" class="rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600">
                    <i data-lucide="x" class="h-5 w-5"></i>
                </button>
            </div>

            <!-- Items -->
            <div class="flex-1 space-y-1 p-4">
                <button class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="bookmark" class="h-5 w-5"></i>
                    <span class="font-medium">Bookmarks</span>
                </button>
                <button onclick="copyLink()" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="share-2" class="h-5 w-5"></i>
                    <span class="font-medium">Share Page</span>
                </button>
                <a href="https://instagram.com" target="_blank" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="instagram" class="h-5 w-5"></i>
                    <span class="font-medium">Subscribe on Insta</span>
                </a>
                <button onclick="alert('Thank you for rating us 5 stars!')" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="star" class="h-5 w-5"></i>
                    <span class="font-medium">Rate Us</span>
                </button>
            </div>

            <!-- Footer -->
            <div class="border-t border-slate-100 p-4">
                <button class="flex w-full items-center justify-center space-x-2 rounded-lg bg-slate-900 px-4 py-3 text-white shadow-md transition-all hover:bg-slate-800 active:scale-95">
                    <i data-lucide="log-in" class="h-5 w-5"></i>
                    <span class="font-medium">Login / Sign Up</span>
                </button>
            </div>
        </div>

        <!-- ================= HEADER ================= -->
        <header class="sticky top-0 z-40 border-b border-indigo-700 bg-gradient-to-r from-violet-600 to-indigo-600 shadow-md">
            <div class="mx-auto flex max-w-3xl items-center justify-between px-4 py-4 text-white">
                
                <!-- Left: Menu & Logo -->
                <div class="flex items-center space-x-4">
                    <button id="open-menu-btn" class="rounded-lg p-1.5 text-indigo-100 transition-colors hover:bg-white/10 hover:text-white">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="hidden h-10 w-10 items-center justify-center rounded-xl bg-white/20 backdrop-blur-sm sm:flex">
                            <i data-lucide="book-open" class="h-6 w-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold tracking-tight text-white sm:text-2xl">Daily Topic</h1>
                            <p class="hidden text-xs font-medium text-indigo-200 sm:block">Expand your knowledge daily</p>
                        </div>
                    </div>
                </div>

                <!-- Right: Streak & Date -->
                <div class="flex items-center space-x-3">
                    <!-- Streak Badge -->
                    <div class="flex items-center space-x-1.5 rounded-full bg-orange-500/20 px-3 py-1.5 backdrop-blur-sm border border-orange-500/30">
                        <i data-lucide="flame" class="h-5 w-5 text-orange-400 fill-orange-500 animate-pulse-slow"></i>
                        <span id="streak-count" class="text-lg font-bold text-white">0</span>
                    </div>

                    <!-- Date Picker Button -->
                    <div class="relative">
                        <div class="flex items-center space-x-2 rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm font-medium text-white backdrop-blur-sm transition-all hover:bg-white/20">
                            <i data-lucide="calendar" class="h-4 w-4 text-indigo-200"></i>
                            <span id="date-display">Latest</span>
                            
                            <!-- Invisible Native Date Input covering the button -->
                            <input type="date" id="date-picker" class="absolute inset-0 z-10 opacity-0 cursor-pointer">
                            
                            <!-- Clear Button -->
                            <div id="clear-date-btn" class="hidden relative z-20 ml-1 rounded-full bg-white/20 p-0.5 hover:bg-white/40 cursor-pointer">
                                <i data-lucide="x" class="h-3 w-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ================= MAIN CONTENT (READER VIEW) ================= -->
        <main id="reader-view" class="mx-auto max-w-3xl px-4 py-8 min-h-screen">
            <div id="articles-container">
                <!-- Articles will be injected here via JS -->
            </div>
            
            <div id="no-articles-msg" class="hidden flex flex-col items-center justify-center py-20 text-center">
                <div class="mb-4 rounded-full bg-slate-100 p-4">
                    <i data-lucide="filter" class="h-8 w-8 text-slate-400"></i>
                </div>
                <p class="text-lg font-semibold text-slate-600">No topics found for this date.</p>
                <button id="reset-filter-btn" class="mt-4 text-sm font-medium text-indigo-600 hover:text-indigo-700">View all topics</button>
            </div>
        </main>

        <!-- ================= ADMIN VIEW (HIDDEN BY DEFAULT) ================= -->
        <main id="admin-view" class="hidden min-h-screen bg-slate-100 pb-20">
            <div class="bg-slate-900 text-white px-4 py-4 shadow-lg sticky top-0 z-40">
                <div class="mx-auto max-w-3xl flex justify-between items-center">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <i data-lucide="pen-line"></i> Publisher Dashboard
                    </h2>
                    <button onclick="toggleView('reader')" class="text-sm text-slate-300 hover:text-white flex items-center gap-1">
                        <i data-lucide="arrow-left" class="h-4 w-4"></i> Back
                    </button>
                </div>
            </div>
            
            <div class="mx-auto max-w-3xl px-4 py-8">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">Compose New Topic</h3>
                    <form id="publish-form">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Title</label>
                            <input type="text" id="post-title" required class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Image URL</label>
                            <input type="url" id="post-image" placeholder="https://..." class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Content</label>
                            <textarea id="post-content" required rows="6" class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                        </div>
                        <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition flex justify-center items-center gap-2">
                            <i data-lucide="send" class="h-4 w-4"></i> Publish Topic
                        </button>
                    </form>
                </div>

                <div class="mt-8">
                    <h3 class="text-sm font-bold uppercase text-slate-500 mb-4">Your Recent Posts</h3>
                    <div id="admin-articles-list" class="space-y-3">
                        <!-- Admin list injected here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- ================= FOOTER ================= -->
        <footer class="border-t border-slate-200 bg-white py-8 mt-auto">
            <div class="mx-auto max-w-3xl px-4 text-center">
                <p class="mb-4 text-slate-400">© 2025 Daily Topic. All rights reserved.</p>
                <button onclick="toggleView('admin')" class="inline-flex items-center text-xs font-medium text-slate-300 transition-colors hover:text-slate-600">
                    <i data-lucide="lock" class="mr-1 h-3 w-3"></i> Admin Access
                </button>
            </div>
        </footer>

    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // State
        let currentUser = null;
        let allArticles = [];
        let selectedDate = '';

        // --- DOM Elements ---
        const els = {
            loading: document.getElementById('loading-screen'),
            menuOverlay: document.getElementById('menu-overlay'),
            menuDrawer: document.getElementById('menu-drawer'),
            readerView: document.getElementById('reader-view'),
            adminView: document.getElementById('admin-view'),
            articlesContainer: document.getElementById('articles-container'),
            adminArticlesList: document.getElementById('admin-articles-list'),
            noArticlesMsg: document.getElementById('no-articles-msg'),
            datePicker: document.getElementById('date-picker'),
            dateDisplay: document.getElementById('date-display'),
            clearDateBtn: document.getElementById('clear-date-btn'),
            streakCount: document.getElementById('streak-count'),
            publishForm: document.getElementById('publish-form'),
            submitBtn: document.getElementById('submit-btn')
        };

        // --- Auth & Init ---
        async function init() {
            try {
                // Determine if we have a custom token (from the environment) or use anonymous
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    // Note: signInWithCustomToken isn't imported to keep imports simple, 
                    // assuming anonymous for this HTML demo, but you can add it if needed.
                    await signInAnonymously(auth); 
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                setupRealtimeListener();
                els.loading.style.display = 'none';
            }
        });

        // --- Firestore Data ---
        function setupRealtimeListener() {
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'daily_articles');
            
            onSnapshot(colRef, (snapshot) => {
                allArticles = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Sort by date desc
                allArticles.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                
                renderArticles();
                renderAdminList();
            });
        }

        // --- Rendering ---
        function renderArticles() {
            els.articlesContainer.innerHTML = '';
            
            // Filter by date
            const filtered = selectedDate 
                ? allArticles.filter(a => {
                    if(!a.createdAt) return false;
                    const d = new Date(a.createdAt.seconds * 1000).toISOString().split('T')[0];
                    return d === selectedDate;
                }) 
                : allArticles;

            if (filtered.length === 0) {
                els.noArticlesMsg.classList.remove('hidden');
            } else {
                els.noArticlesMsg.classList.add('hidden');
                
                filtered.forEach(article => {
                    const dateStr = article.createdAt 
                        ? new Date(article.createdAt.seconds * 1000).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
                        : '';

                    const card = document.createElement('div');
                    card.className = "group relative mb-8 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm transition-all hover:shadow-md";
                    
                    let imageHtml = '';
                    if (article.imageUrl) {
                        imageHtml = `
                            <div class="h-64 w-full overflow-hidden bg-slate-100">
                                <img src="${article.imageUrl}" alt="${article.title}" class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105" onerror="this.style.display='none'">
                            </div>
                        `;
                    }

                    // Simple "Read More" logic via CSS classes could be done, but for simple HTML we'll just show all text or clamp it.
                    // We'll use CSS line-clamp for simplicity.
                    
                    card.innerHTML = `
                        ${imageHtml}
                        <div class="p-6 md:p-8">
                            <div class="mb-4 flex items-center justify-between">
                                <span class="flex items-center text-xs font-bold uppercase tracking-widest text-indigo-600">
                                    <i data-lucide="calendar" class="mr-1.5 h-3 w-3"></i> ${dateStr}
                                </span>
                            </div>
                            <h3 class="mb-4 text-2xl font-extrabold text-slate-900 md:text-3xl">${article.title}</h3>
                            <div class="prose prose-lg prose-slate max-w-none text-slate-600">
                                ${article.content.split('\n').map(p => `<p class="mb-4 leading-relaxed">${p}</p>`).join('')}
                            </div>
                        </div>
                    `;
                    els.articlesContainer.appendChild(card);
                });
                lucide.createIcons();
            }
        }

        function renderAdminList() {
            els.adminArticlesList.innerHTML = '';
            allArticles.forEach(article => {
                const item = document.createElement('div');
                item.className = "flex items-center justify-between bg-white p-3 rounded-lg border border-slate-200";
                item.innerHTML = `
                    <span class="font-medium truncate flex-1">${article.title}</span>
                    <button class="text-red-500 hover:bg-red-50 p-2 rounded-full delete-btn" data-id="${article.id}">
                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                    </button>
                `;
                els.adminArticlesList.appendChild(item);
            });
            
            // Attach delete listeners
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => deletePost(e.currentTarget.dataset.id));
            });
            lucide.createIcons();
        }

        // --- Actions ---
        els.publishForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if(!currentUser) return;
            
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;
            const imageUrl = document.getElementById('post-image').value;
            
            const btn = els.submitBtn;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'Publishing...';

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'daily_articles'), {
                    title, content, imageUrl,
                    createdAt: serverTimestamp(),
                    userId: currentUser.uid
                });
                els.publishForm.reset();
                alert('Topic Published!');
            } catch (err) {
                console.error(err);
                alert('Error publishing');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                lucide.createIcons();
            }
        });

        async function deletePost(id) {
            if(confirm('Delete this post?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'daily_articles', id));
            }
        }

        // --- UI Logic ---
        
        // View Toggle
        window.toggleView = (mode) => {
            if (mode === 'admin') {
                els.readerView.classList.add('hidden');
                els.adminView.classList.remove('hidden');
            } else {
                els.readerView.classList.remove('hidden');
                els.adminView.classList.add('hidden');
            }
            window.scrollTo(0,0);
        };

        // Menu Toggle
        const openMenu = () => {
            els.menuOverlay.classList.remove('opacity-0', 'pointer-events-none');
            els.menuDrawer.classList.remove('-translate-x-full');
        };
        const closeMenu = () => {
            els.menuOverlay.classList.add('opacity-0', 'pointer-events-none');
            els.menuDrawer.classList.add('-translate-x-full');
        };

        document.getElementById('open-menu-btn').addEventListener('click', openMenu);
        document.getElementById('close-menu-btn').addEventListener('click', closeMenu);
        els.menuOverlay.addEventListener('click', closeMenu);

        // Date Picker
        els.datePicker.addEventListener('change', (e) => {
            selectedDate = e.target.value;
            els.dateDisplay.innerText = selectedDate ? new Date(selectedDate).toLocaleDateString(undefined, {month: 'short', day: 'numeric'}) : 'Latest';
            if(selectedDate) {
                els.clearDateBtn.classList.remove('hidden');
                els.clearDateBtn.classList.add('flex');
            } else {
                els.clearDateBtn.classList.add('hidden');
            }
            renderArticles();
        });

        els.clearDateBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // prevent opening picker
            selectedDate = '';
            els.datePicker.value = '';
            els.dateDisplay.innerText = 'Latest';
            els.clearDateBtn.classList.add('hidden');
            renderArticles();
        });
        
        document.getElementById('reset-filter-btn').addEventListener('click', () => {
             els.clearDateBtn.click();
        });

        // Copy Link
        window.copyLink = () => {
            navigator.clipboard.writeText(window.location.href);
            alert('Link copied!');
            closeMenu();
        };

        // --- Streak Logic ---
        function checkStreak() {
            const today = new Date().toDateString();
            const lastVisit = localStorage.getItem('dt_last_visit');
            let currentStreak = parseInt(localStorage.getItem('dt_streak') || '0');

            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    currentStreak++;
                } else {
                    currentStreak = 1; // Reset or start new
                }
                
                localStorage.setItem('dt_streak', currentStreak);
                localStorage.setItem('dt_last_visit', today);
            }
            
            els.streakCount.innerText = currentStreak;
        }

        // Initialize Icons & Logic
        lucide.createIcons();
        checkStreak();
        init();

    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Topic Publisher</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for Typography and Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Hide Date Input Icon but keep functionality */
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900 overflow-x-hidden">

    <!-- App Container -->
    <div id="app">
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 z-[60] flex items-center justify-center bg-white">
            <div class="loader"></div>
        </div>

        <!-- ================= SIDE MENU (DRAWER) ================= -->
        <div id="menu-overlay" class="fixed inset-0 z-50 bg-slate-900/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300"></div>
        
        <div id="menu-drawer" class="fixed inset-y-0 left-0 z-50 w-72 transform -translate-x-full bg-white shadow-2xl transition-transform duration-300 ease-in-out flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between border-b border-slate-100 p-5">
                <div class="flex items-center space-x-2">
                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-600 text-white">
                        <i data-lucide="book-open" class="h-5 w-5"></i>
                    </div>
                    <span class="text-lg font-bold text-slate-800">Menu</span>
                </div>
                <button id="close-menu-btn" class="rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600">
                    <i data-lucide="x" class="h-5 w-5"></i>
                </button>
            </div>

            <!-- Items -->
            <div class="flex-1 space-y-1 p-4">
                <button class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="bookmark" class="h-5 w-5"></i>
                    <span class="font-medium">Bookmarks</span>
                </button>
                <button onclick="copyLink()" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="share-2" class="h-5 w-5"></i>
                    <span class="font-medium">Share Page</span>
                </button>
                <a href="https://instagram.com" target="_blank" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="instagram" class="h-5 w-5"></i>
                    <span class="font-medium">Subscribe on Insta</span>
                </a>
                <button onclick="alert('Thank you for rating us 5 stars!')" class="flex w-full items-center space-x-3 rounded-lg px-4 py-3 text-slate-600 transition-colors hover:bg-slate-50 hover:text-indigo-600">
                    <i data-lucide="star" class="h-5 w-5"></i>
                    <span class="font-medium">Rate Us</span>
                </button>
            </div>

            <!-- Footer -->
            <div class="border-t border-slate-100 p-4">
                <button class="flex w-full items-center justify-center space-x-2 rounded-lg bg-slate-900 px-4 py-3 text-white shadow-md transition-all hover:bg-slate-800 active:scale-95">
                    <i data-lucide="log-in" class="h-5 w-5"></i>
                    <span class="font-medium">Login / Sign Up</span>
                </button>
            </div>
        </div>

        <!-- ================= HEADER ================= -->
        <header class="sticky top-0 z-40 border-b border-indigo-700 bg-gradient-to-r from-violet-600 to-indigo-600 shadow-md">
            <div class="mx-auto flex max-w-3xl items-center justify-between px-4 py-4 text-white">
                
                <!-- Left: Menu & Logo -->
                <div class="flex items-center space-x-4">
                    <button id="open-menu-btn" class="rounded-lg p-1.5 text-indigo-100 transition-colors hover:bg-white/10 hover:text-white">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="hidden h-10 w-10 items-center justify-center rounded-xl bg-white/20 backdrop-blur-sm sm:flex">
                            <i data-lucide="book-open" class="h-6 w-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold tracking-tight text-white sm:text-2xl">Daily Topic</h1>
                            <p class="hidden text-xs font-medium text-indigo-200 sm:block">Expand your knowledge daily</p>
                        </div>
                    </div>
                </div>

                <!-- Right: Streak & Date -->
                <div class="flex items-center space-x-3">
                    <!-- Streak Badge -->
                    <div class="flex items-center space-x-1.5 rounded-full bg-orange-500/20 px-3 py-1.5 backdrop-blur-sm border border-orange-500/30">
                        <i data-lucide="flame" class="h-5 w-5 text-orange-400 fill-orange-500 animate-pulse-slow"></i>
                        <span id="streak-count" class="text-lg font-bold text-white">0</span>
                    </div>

                    <!-- Date Picker Button -->
                    <div class="relative">
                        <div class="flex items-center space-x-2 rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm font-medium text-white backdrop-blur-sm transition-all hover:bg-white/20">
                            <i data-lucide="calendar" class="h-4 w-4 text-indigo-200"></i>
                            <span id="date-display">Latest</span>
                            
                            <!-- Invisible Native Date Input covering the button -->
                            <input type="date" id="date-picker" class="absolute inset-0 z-10 opacity-0 cursor-pointer">
                            
                            <!-- Clear Button -->
                            <div id="clear-date-btn" class="hidden relative z-20 ml-1 rounded-full bg-white/20 p-0.5 hover:bg-white/40 cursor-pointer">
                                <i data-lucide="x" class="h-3 w-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ================= MAIN CONTENT (READER VIEW) ================= -->
        <main id="reader-view" class="mx-auto max-w-3xl px-4 py-8 min-h-screen">
            <div id="articles-container">
                <!-- Articles will be injected here via JS -->
            </div>
            
            <div id="no-articles-msg" class="hidden flex flex-col items-center justify-center py-20 text-center">
                <div class="mb-4 rounded-full bg-slate-100 p-4">
                    <i data-lucide="filter" class="h-8 w-8 text-slate-400"></i>
                </div>
                <p class="text-lg font-semibold text-slate-600">No topics found for this date.</p>
                <button id="reset-filter-btn" class="mt-4 text-sm font-medium text-indigo-600 hover:text-indigo-700">View all topics</button>
            </div>
        </main>

        <!-- ================= ADMIN VIEW (HIDDEN BY DEFAULT) ================= -->
        <main id="admin-view" class="hidden min-h-screen bg-slate-100 pb-20">
            <div class="bg-slate-900 text-white px-4 py-4 shadow-lg sticky top-0 z-40">
                <div class="mx-auto max-w-3xl flex justify-between items-center">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <i data-lucide="pen-line"></i> Publisher Dashboard
                    </h2>
                    <button onclick="toggleView('reader')" class="text-sm text-slate-300 hover:text-white flex items-center gap-1">
                        <i data-lucide="arrow-left" class="h-4 w-4"></i> Back
                    </button>
                </div>
            </div>
            
            <div class="mx-auto max-w-3xl px-4 py-8">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">Compose New Topic</h3>
                    <form id="publish-form">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Title</label>
                            <input type="text" id="post-title" required class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Image URL</label>
                            <input type="url" id="post-image" placeholder="https://..." class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Content</label>
                            <textarea id="post-content" required rows="6" class="w-full rounded-lg border border-slate-200 px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                        </div>
                        <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition flex justify-center items-center gap-2">
                            <i data-lucide="send" class="h-4 w-4"></i> Publish Topic
                        </button>
                    </form>
                </div>

                <div class="mt-8">
                    <h3 class="text-sm font-bold uppercase text-slate-500 mb-4">Your Recent Posts</h3>
                    <div id="admin-articles-list" class="space-y-3">
                        <!-- Admin list injected here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- ================= FOOTER ================= -->
        <footer class="border-t border-slate-200 bg-white py-8 mt-auto">
            <div class="mx-auto max-w-3xl px-4 text-center">
                <p class="mb-4 text-slate-400">© 2025 Daily Topic. All rights reserved.</p>
                <button onclick="toggleView('admin')" class="inline-flex items-center text-xs font-medium text-slate-300 transition-colors hover:text-slate-600">
                    <i data-lucide="lock" class="mr-1 h-3 w-3"></i> Admin Access
                </button>
            </div>
        </footer>

    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // State
        let currentUser = null;
        let allArticles = [];
        let selectedDate = '';

        // --- DOM Elements ---
        const els = {
            loading: document.getElementById('loading-screen'),
            menuOverlay: document.getElementById('menu-overlay'),
            menuDrawer: document.getElementById('menu-drawer'),
            readerView: document.getElementById('reader-view'),
            adminView: document.getElementById('admin-view'),
            articlesContainer: document.getElementById('articles-container'),
            adminArticlesList: document.getElementById('admin-articles-list'),
            noArticlesMsg: document.getElementById('no-articles-msg'),
            datePicker: document.getElementById('date-picker'),
            dateDisplay: document.getElementById('date-display'),
            clearDateBtn: document.getElementById('clear-date-btn'),
            streakCount: document.getElementById('streak-count'),
            publishForm: document.getElementById('publish-form'),
            submitBtn: document.getElementById('submit-btn')
        };

        // --- Auth & Init ---
        async function init() {
            try {
                // Determine if we have a custom token (from the environment) or use anonymous
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    // Note: signInWithCustomToken isn't imported to keep imports simple, 
                    // assuming anonymous for this HTML demo, but you can add it if needed.
                    await signInAnonymously(auth); 
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                setupRealtimeListener();
                els.loading.style.display = 'none';
            }
        });

        // --- Firestore Data ---
        function setupRealtimeListener() {
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'daily_articles');
            
            onSnapshot(colRef, (snapshot) => {
                allArticles = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Sort by date desc
                allArticles.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                
                renderArticles();
                renderAdminList();
            });
        }

        // --- Rendering ---
        function renderArticles() {
            els.articlesContainer.innerHTML = '';
            
            // Filter by date
            const filtered = selectedDate 
                ? allArticles.filter(a => {
                    if(!a.createdAt) return false;
                    const d = new Date(a.createdAt.seconds * 1000).toISOString().split('T')[0];
                    return d === selectedDate;
                }) 
                : allArticles;

            if (filtered.length === 0) {
                els.noArticlesMsg.classList.remove('hidden');
            } else {
                els.noArticlesMsg.classList.add('hidden');
                
                filtered.forEach(article => {
                    const dateStr = article.createdAt 
                        ? new Date(article.createdAt.seconds * 1000).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
                        : '';

                    const card = document.createElement('div');
                    card.className = "group relative mb-8 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm transition-all hover:shadow-md";
                    
                    let imageHtml = '';
                    if (article.imageUrl) {
                        imageHtml = `
                            <div class="h-64 w-full overflow-hidden bg-slate-100">
                                <img src="${article.imageUrl}" alt="${article.title}" class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105" onerror="this.style.display='none'">
                            </div>
                        `;
                    }

                    // Simple "Read More" logic via CSS classes could be done, but for simple HTML we'll just show all text or clamp it.
                    // We'll use CSS line-clamp for simplicity.
                    
                    card.innerHTML = `
                        ${imageHtml}
                        <div class="p-6 md:p-8">
                            <div class="mb-4 flex items-center justify-between">
                                <span class="flex items-center text-xs font-bold uppercase tracking-widest text-indigo-600">
                                    <i data-lucide="calendar" class="mr-1.5 h-3 w-3"></i> ${dateStr}
                                </span>
                            </div>
                            <h3 class="mb-4 text-2xl font-extrabold text-slate-900 md:text-3xl">${article.title}</h3>
                            <div class="prose prose-lg prose-slate max-w-none text-slate-600">
                                ${article.content.split('\n').map(p => `<p class="mb-4 leading-relaxed">${p}</p>`).join('')}
                            </div>
                        </div>
                    `;
                    els.articlesContainer.appendChild(card);
                });
                lucide.createIcons();
            }
        }

        function renderAdminList() {
            els.adminArticlesList.innerHTML = '';
            allArticles.forEach(article => {
                const item = document.createElement('div');
                item.className = "flex items-center justify-between bg-white p-3 rounded-lg border border-slate-200";
                item.innerHTML = `
                    <span class="font-medium truncate flex-1">${article.title}</span>
                    <button class="text-red-500 hover:bg-red-50 p-2 rounded-full delete-btn" data-id="${article.id}">
                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                    </button>
                `;
                els.adminArticlesList.appendChild(item);
            });
            
            // Attach delete listeners
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => deletePost(e.currentTarget.dataset.id));
            });
            lucide.createIcons();
        }

        // --- Actions ---
        els.publishForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if(!currentUser) return;
            
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;
            const imageUrl = document.getElementById('post-image').value;
            
            const btn = els.submitBtn;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'Publishing...';

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'daily_articles'), {
                    title, content, imageUrl,
                    createdAt: serverTimestamp(),
                    userId: currentUser.uid
                });
                els.publishForm.reset();
                alert('Topic Published!');
            } catch (err) {
                console.error(err);
                alert('Error publishing');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                lucide.createIcons();
            }
        });

        async function deletePost(id) {
            if(confirm('Delete this post?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'daily_articles', id));
            }
        }

        // --- UI Logic ---
        
        // View Toggle
        window.toggleView = (mode) => {
            if (mode === 'admin') {
                els.readerView.classList.add('hidden');
                els.adminView.classList.remove('hidden');
            } else {
                els.readerView.classList.remove('hidden');
                els.adminView.classList.add('hidden');
            }
            window.scrollTo(0,0);
        };

        // Menu Toggle
        const openMenu = () => {
            els.menuOverlay.classList.remove('opacity-0', 'pointer-events-none');
            els.menuDrawer.classList.remove('-translate-x-full');
        };
        const closeMenu = () => {
            els.menuOverlay.classList.add('opacity-0', 'pointer-events-none');
            els.menuDrawer.classList.add('-translate-x-full');
        };

        document.getElementById('open-menu-btn').addEventListener('click', openMenu);
        document.getElementById('close-menu-btn').addEventListener('click', closeMenu);
        els.menuOverlay.addEventListener('click', closeMenu);

        // Date Picker
        els.datePicker.addEventListener('change', (e) => {
            selectedDate = e.target.value;
            els.dateDisplay.innerText = selectedDate ? new Date(selectedDate).toLocaleDateString(undefined, {month: 'short', day: 'numeric'}) : 'Latest';
            if(selectedDate) {
                els.clearDateBtn.classList.remove('hidden');
                els.clearDateBtn.classList.add('flex');
            } else {
                els.clearDateBtn.classList.add('hidden');
            }
            renderArticles();
        });

        els.clearDateBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // prevent opening picker
            selectedDate = '';
            els.datePicker.value = '';
            els.dateDisplay.innerText = 'Latest';
            els.clearDateBtn.classList.add('hidden');
            renderArticles();
        });
        
        document.getElementById('reset-filter-btn').addEventListener('click', () => {
             els.clearDateBtn.click();
        });

        // Copy Link
        window.copyLink = () => {
            navigator.clipboard.writeText(window.location.href);
            alert('Link copied!');
            closeMenu();
        };

        // --- Streak Logic ---
        function checkStreak() {
            const today = new Date().toDateString();
            const lastVisit = localStorage.getItem('dt_last_visit');
            let currentStreak = parseInt(localStorage.getItem('dt_streak') || '0');

            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    currentStreak++;
                } else {
                    currentStreak = 1; // Reset or start new
                }
                
                localStorage.setItem('dt_streak', currentStreak);
                localStorage.setItem('dt_last_visit', today);
            }
            
            els.streakCount.innerText = currentStreak;
        }

        // Initialize Icons & Logic
        lucide.createIcons();
        checkStreak();
        init();

    </script>
</body>
</html>