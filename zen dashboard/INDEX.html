<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenTrack Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar for a cleaner look */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        /* Safe area for mobile bottom nav */
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>
<body class="bg-[#f3f6f4] font-sans text-slate-800">
    <div id="root"></div>

    <!-- Main Script using ES Modules -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0?dev';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client?dev';
        import { 
            CheckCircle, Plus, Calendar, TrendingUp, Activity, MoreHorizontal, 
            Leaf, Layout, Settings, Bell, Search, CheckSquare, X, User, 
            LogOut, ChevronRight, Clock, Play, Pause, RotateCcw, Timer, 
            FileText, Download, Upload, Save, Trash2, ArrowLeft, Edit3, 
            Image as ImageIcon, BarChart2, Quote, MoreVertical, Monitor, Zap, Coffee, Lock, Fingerprint, Key
        } from 'https://esm.sh/lucide-react@0.263.1?dev';

        // --- Components ---

        // Simple Card Component
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-2xl shadow-sm border border-slate-100 p-4 md:p-6 ${className}`}>
                {children}
            </div>
        );

        // Modal Component
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm transition-all">
                    <div className="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all scale-100 overflow-hidden animate-fadeIn">
                        <div className="flex items-center justify-between p-4 border-b border-slate-100 bg-slate-50/50">
                            <h3 className="text-lg font-bold text-[#1b4332]">{title}</h3>
                            <button 
                                onClick={onClose}
                                className="p-1 rounded-full hover:bg-slate-200 text-slate-400 transition-colors"
                            >
                                <X size={20} />
                            </button>
                        </div>
                        <div className="p-6">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Progress Circle
        const ProgressCircle = ({ percentage, color = "#4ade80", size = 120, strokeWidth = 10 }) => {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percentage / 100) * circumference;

            return (
                <div className="relative flex items-center justify-center" style={{ width: size, height: size }}>
                    <svg className="transform -rotate-90 w-full h-full">
                        <circle
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            stroke="#f1f5f9"
                            strokeWidth={strokeWidth}
                            fill="transparent"
                        />
                        <circle
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            stroke={color}
                            strokeWidth={strokeWidth}
                            fill="transparent"
                            strokeDasharray={circumference}
                            strokeDashoffset={offset}
                            strokeLinecap="round"
                            className="transition-all duration-1000 ease-out"
                        />
                    </svg>
                    <div className="absolute text-2xl font-bold text-slate-700">
                        {percentage}%
                    </div>
                </div>
            );
        };

        // Mini Sparkline
        const MiniSparkline = ({ data, color }) => {
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            const height = 40;
            const width = 100;
            
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((val - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');

            return (
                <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`} preserveAspectRatio="none">
                    <polyline
                        points={points}
                        fill="none"
                        stroke={color}
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                    />
                </svg>
            );
        };

        // Simple Bar Chart
        const SimpleBarChart = ({ data, labels, color = "#10b981" }) => {
            const maxVal = Math.max(...data, 100); 

            return (
                <div className="w-full h-48 flex items-end justify-between gap-1 md:gap-2">
                    {data.map((val, i) => {
                        const barHeight = (val / maxVal) * 100;
                        return (
                            <div key={i} className="flex-1 flex flex-col items-center gap-2 group">
                                <div className="relative w-full flex items-end justify-center h-36 bg-slate-50 rounded-lg overflow-hidden">
                                    <div 
                                        style={{ height: `${barHeight}%` }} 
                                        className={`w-full mx-0.5 md:mx-1 rounded-t-md transition-all duration-500 ease-out opacity-80 group-hover:opacity-100 ${color}`}
                                    ></div>
                                    <div className="hidden md:block absolute -top-8 bg-slate-800 text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity">
                                        {val}%
                                    </div>
                                </div>
                                <span className="text-[10px] md:text-xs text-slate-400 font-medium truncate w-full text-center">{labels[i]}</span>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // --- Main Application ---

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isProfileOpen, setIsProfileOpen] = useState(false);
            const [isDesktopProfileOpen, setIsDesktopProfileOpen] = useState(false);
            const [isSettingsHovered, setIsSettingsHovered] = useState(false);
            const [isEditProfileModalOpen, setIsEditProfileModalOpen] = useState(false);
            const [profileData, setProfileData] = useState({
                name: 'Prashant Jangra',
                email: 'prashant@example.com',
                bio: 'Productivity Enthusiast'
            });
            const [appTheme, setAppTheme] = useState('light');
            const [currentTheme, setCurrentTheme] = useState('default');
            const themes = {
                default: { name: 'Zen Green', colors: { primary: '#1b4332', secondary: '#2d6a4f', accent: '#40916c', bg: '#f3f6f4', sidebarBottom: '#153628' } },
                ocean: { name: 'Ocean Blue', colors: { primary: '#1e3a8a', secondary: '#1e40af', accent: '#3b82f6', bg: '#eff6ff', sidebarBottom: '#172554' } },
                sunset: { name: 'Sunset Orange', colors: { primary: '#9a3412', secondary: '#c2410c', accent: '#f97316', bg: '#fff7ed', sidebarBottom: '#7c2d12' } },
                berry: { name: 'Berry Pink', colors: { primary: '#831843', secondary: '#9d174d', accent: '#ec4899', bg: '#fdf2f8', sidebarBottom: '#500724' } },
                royal: { name: 'Royal Purple', colors: { primary: '#4c1d95', secondary: '#6d28d9', accent: '#8b5cf6', bg: '#f5f3ff', sidebarBottom: '#2e1065' } },
                teal: { name: 'Fresh Teal', colors: { primary: '#134e4a', secondary: '#0f766e', accent: '#14b8a6', bg: '#f0fdfa', sidebarBottom: '#115e59' } }
            };
            const [securitySettings, setSecuritySettings] = useState({
                appLock: false,
                biometric: false
            });
            const [isNavVisible, setIsNavVisible] = useState(true);
            const [isMoreMenuOpen, setIsMoreMenuOpen] = useState(false);
            
            // Search & Notifications
            const [isNotificationsOpen, setIsNotificationsOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);

            const lastScrollY = useRef(0);
            const scrollContainerRef = useRef(null);
            const notificationRef = useRef(null);
            const desktopProfileRef = useRef(null);
            const mobileProfileRef = useRef(null);
            const moreMenuRef = useRef(null);
            const moreBtnRef = useRef(null);
            const fileInputRef = useRef(null);
            const [profileImage, setProfileImage] = useState(null);

            // Modals
            const [isHabitModalOpen, setIsHabitModalOpen] = useState(false);
            const [isTaskModalOpen, setIsTaskModalOpen] = useState(false);

            // Focus Mode
            const [focusType, setFocusType] = useState('timer');
            const [timerTime, setTimerTime] = useState(25 * 60);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const [timerDuration, setTimerDuration] = useState(25 * 60);
            const [stopwatchTime, setStopwatchTime] = useState(0);
            const [isStopwatchRunning, setIsStopwatchRunning] = useState(false);
            const [simulatorHour, setSimulatorHour] = useState(22);
            
            // New Focus Mode State
            const [focusMode, setFocusMode] = useState('light'); // light, deep, monk
            const [focusTask, setFocusTask] = useState('Deep Work Session');
            const [scratchpad, setScratchpad] = useState('');
            const [parkingLot, setParkingLot] = useState('');
            const [isParkingLotOpen, setIsParkingLotOpen] = useState(false);
            const [sessionComplete, setSessionComplete] = useState(false);
            const [sessionDepth, setSessionDepth] = useState(50);
            const [totalFocusTime, setTotalFocusTime] = useState(0);

            // Analysis
            const [analysisView, setAnalysisView] = useState('weekly');

            // Notes
            const [notesView, setNotesView] = useState('list');
            const [activeNote, setActiveNote] = useState(null);
            const [notes, setNotes] = useState([
                { id: 1, title: '2026 Resolutions Idea', content: 'Focus on mindfulness and gardening more often.', category: 'Journal', date: 'Oct 25, 2025' },
                { id: 2, title: 'Garden Layout', content: 'Need to buy more Hydrangeas for the north side.', category: 'Ideas', date: 'Oct 24, 2025' }
            ]);
            const [noteForm, setNoteForm] = useState({ title: '', content: '', category: 'Journal' });

            // Form Data
            const [newHabit, setNewHabit] = useState({ name: '', category: 'Health' });
            const [newTask, setNewTask] = useState({ title: '', priority: 'Medium', due: 'Today' });

            // Mock Data
            const [habits, setHabits] = useState([
                { id: 1, name: 'Morning Meditation', streak: 12, completedToday: true, category: 'Mind', color: 'bg-indigo-200 text-indigo-800' },
                { id: 2, name: 'Forest Walk', streak: 5, completedToday: false, category: 'Body', color: 'bg-emerald-200 text-emerald-800' },
                { id: 3, name: 'Read 30 Mins', streak: 24, completedToday: false, category: 'Growth', color: 'bg-fuchsia-200 text-fuchsia-800' },
                { id: 4, name: 'Drink 2L Water', streak: 8, completedToday: true, category: 'Health', color: 'bg-cyan-200 text-cyan-800' },
            ]);

            const [tasks, setTasks] = useState([
                { id: 1, title: '2026 Vision Board', priority: 'High', due: '2:00 PM', completed: false, tag: 'Work' },
                { id: 2, title: 'Plant new hydrangeas', priority: 'Medium', due: '5:00 PM', completed: false, tag: 'Personal' },
                { id: 3, title: 'Call Insurance', priority: 'Low', due: 'Tomorrow', completed: true, tag: 'Admin' },
            ]);

            const [currentDate, setCurrentDate] = useState(new Date());

            // Mock Screen Time Data
            const screenTimeData = {
                total: 385, // 6h 25m
                productive: 260,
                distraction: 125,
                switches: 42,
                hygiene: 78,
                apps: [
                    { name: 'VS Code', time: 180, type: 'productive', icon: 'ðŸ’»' },
                    { name: 'Chrome (Work)', time: 80, type: 'productive', icon: 'ðŸŒ' },
                    { name: 'Slack', time: 45, type: 'communication', icon: '#ï¸âƒ£' },
                    { name: 'YouTube', time: 60, type: 'distraction', icon: 'â–¶ï¸' },
                    { name: 'Instagram', time: 20, type: 'distraction', icon: 'ðŸ“¸' },
                ]
            };

            // --- Effects ---
            
            // Timer Logic
            useEffect(() => {
                let interval = null;
                if (isTimerRunning && timerTime > 0) {
                    interval = setInterval(() => setTimerTime(t => t - 1), 1000);
                } else if (timerTime === 0 && isTimerRunning) {
                    setIsTimerRunning(false);
                    setTotalFocusTime(prev => prev + timerDuration);
                    setTimerTime(timerDuration);
                }
                return () => clearInterval(interval);
            }, [isTimerRunning, timerTime, timerDuration]);

            // Stopwatch Logic
            useEffect(() => {
                let interval = null;
                if (isStopwatchRunning) {
                    interval = setInterval(() => setStopwatchTime(t => t + 1), 1000);
                }
                return () => clearInterval(interval);
            }, [isStopwatchRunning]);

            // Date Clock
            useEffect(() => {
                const timer = setInterval(() => setCurrentDate(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);

            // Search Logic
            useEffect(() => {
                if (!searchQuery) {
                    setSearchResults([]);
                    return;
                }
                const lowerQuery = searchQuery.toLowerCase();
                const matchedTasks = tasks.filter(t => t.title.toLowerCase().includes(lowerQuery)).map(t => ({...t, type: 'task'}));
                const matchedHabits = habits.filter(h => h.name.toLowerCase().includes(lowerQuery)).map(h => ({...h, type: 'habit'}));
                setSearchResults([...matchedTasks, ...matchedHabits]);
            }, [searchQuery, tasks, habits]);

            // Click Outside Handler for Notifications
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (notificationRef.current && !notificationRef.current.contains(event.target)) {
                        setIsNotificationsOpen(false);
                    }
                    if (desktopProfileRef.current && !desktopProfileRef.current.contains(event.target)) {
                        setIsDesktopProfileOpen(false);
                    }
                    if (mobileProfileRef.current && !mobileProfileRef.current.contains(event.target)) {
                        setIsProfileOpen(false);
                    }
                    if (moreMenuRef.current && !moreMenuRef.current.contains(event.target) && (!moreBtnRef.current || !moreBtnRef.current.contains(event.target))) {
                        setIsMoreMenuOpen(false);
                    }
                };
                if (isNotificationsOpen || isDesktopProfileOpen || isProfileOpen || isMoreMenuOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                }
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [isNotificationsOpen, isDesktopProfileOpen, isProfileOpen, isMoreMenuOpen]);

            // Theme Application
            useEffect(() => {
                const theme = themes[currentTheme];
                const root = document.documentElement;
                root.style.setProperty('--primary', theme.colors.primary);
                root.style.setProperty('--secondary', theme.colors.secondary);
                root.style.setProperty('--accent', theme.colors.accent);
                root.style.setProperty('--bg-main', theme.colors.bg);
                root.style.setProperty('--sidebar-bottom', theme.colors.sidebarBottom);
                document.body.style.backgroundColor = theme.colors.bg;
            }, [currentTheme]);

            // Scroll Handler
            useEffect(() => {
                const handleScroll = () => {
                    if (scrollContainerRef.current) {
                        const currentScrollY = scrollContainerRef.current.scrollTop;
                        const threshold = 10;
                        if (Math.abs(currentScrollY - lastScrollY.current) > threshold) {
                            if (currentScrollY > lastScrollY.current && currentScrollY > 20) {
                                setIsNavVisible(false);
                            } else {
                                setIsNavVisible(true);
                            }
                            lastScrollY.current = currentScrollY;
                        }
                    }
                };
                const container = scrollContainerRef.current;
                if (container) {
                    container.addEventListener('scroll', handleScroll);
                    return () => container.removeEventListener('scroll', handleScroll);
                }
            }, []);

            // --- Helpers ---
            const formatTime = (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            };

            const toggleHabit = (id) => {
                setHabits(habits.map(h => h.id === id ? { ...h, completedToday: !h.completedToday } : h));
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            const addHabit = () => {
                if (!newHabit.name) return;
                let color = 'bg-slate-200 text-slate-800';
                if (newHabit.category === 'Mind') color = 'bg-indigo-200 text-indigo-800';
                if (newHabit.category === 'Body') color = 'bg-emerald-200 text-emerald-800';
                if (newHabit.category === 'Growth') color = 'bg-fuchsia-200 text-fuchsia-800';
                if (newHabit.category === 'Health') color = 'bg-cyan-200 text-cyan-800';

                setHabits([...habits, {
                    id: Date.now(),
                    name: newHabit.name,
                    streak: 0,
                    completedToday: false,
                    category: newHabit.category,
                    color: color
                }]);
                setNewHabit({ name: '', category: 'Health' });
                setIsHabitModalOpen(false);
            };

            const addTask = () => {
                if (!newTask.title) return;
                setTasks([...tasks, {
                    id: Date.now(),
                    title: newTask.title,
                    priority: newTask.priority,
                    due: newTask.due,
                    completed: false,
                    tag: 'General'
                }]);
                setNewTask({ title: '', priority: 'Medium', due: 'Today' });
                setIsTaskModalOpen(false);
            };

            const handleSaveNote = () => {
                if (!noteForm.title) return;
                if (activeNote) {
                    setNotes(notes.map(n => n.id === activeNote.id ? { ...n, ...noteForm, date: 'Edited just now' } : n));
                } else {
                    setNotes([...notes, {
                        id: Date.now(),
                        ...noteForm,
                        date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
                    }]);
                }
                setNotesView('list');
                setActiveNote(null);
                setNoteForm({ title: '', content: '', category: 'Journal' });
            };

            const handleDeleteNote = (id) => {
                setNotes(notes.filter(n => n.id !== id));
                if (activeNote && activeNote.id === id) {
                    setNotesView('list');
                    setActiveNote(null);
                }
            };

            const openNoteEditor = (note = null) => {
                if (note) {
                    setActiveNote(note);
                    setNoteForm({ title: note.title, content: note.content, category: note.category });
                } else {
                    setActiveNote(null);
                    setNoteForm({ title: '', content: '', category: 'Journal' });
                }
                setNotesView('edit');
            };

            const handleExport = () => {
                const data = JSON.stringify({ habits, tasks, notes }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'zentrack_data.json';
                a.click();
                URL.revokeObjectURL(url);
            };

            const handleImport = () => {
                alert("Import feature ready! This would connect to your backend.");
            };

            const handleAddImage = () => {
                alert("Image upload placeholder.");
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProfileImage(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Calculated Stats
            const completedHabitsCount = habits.filter(h => h.completedToday).length;
            const progressPercentage = habits.length > 0 ? Math.round((completedHabitsCount / habits.length) * 100) : 0;
            
            const getYearProgress = () => {
                const now = new Date();
                const start = new Date(now.getFullYear(), 0, 0);
                const diff = now - start;
                const oneDay = 1000 * 60 * 60 * 24;
                const dayOfYear = Math.floor(diff / oneDay);
                const totalDays = 365 + (now.getFullYear() % 4 === 0 ? 1 : 0);
                return Math.floor((dayOfYear / totalDays) * 100);
            };
            const yearProgress = getYearProgress();
            const is2026 = new Date().getFullYear() === 2026;

            const navItems = [
                { id: 'dashboard', icon: Layout, label: 'Home' },
                { id: 'habits', icon: Activity, label: 'Habits' },
                { id: 'tasks', icon: CheckSquare, label: 'Tasks' },
                { id: 'focus', icon: Clock, label: 'Focus' },
                { id: 'screen-time', icon: Monitor, label: 'Screen Time' },
                { id: 'notes', icon: FileText, label: 'Notes' },
                { id: 'calendar', icon: Calendar, label: '2026' },
            ];

            // Render Content
            const renderContent = () => {
                switch (activeTab) {
                    case 'habits':
                        return (
                            <div className="space-y-6 animate-fadeIn">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl md:text-2xl font-bold text-[var(--primary)]">All Habits</h2>
                                    <button onClick={() => setIsHabitModalOpen(true)} className="flex items-center gap-2 bg-[var(--primary)] text-white px-3 py-2 rounded-xl hover:bg-[var(--secondary)] transition-colors text-sm font-medium">
                                        <Plus size={18} /> <span className="hidden md:inline">Add Habit</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {habits.map((habit) => (
                                        <div key={habit.id} onClick={() => toggleHabit(habit.id)} className="bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-md transition-all">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className={`w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center ${habit.color} bg-opacity-30`}>
                                                    <Activity size={20} />
                                                </div>
                                                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${habit.completedToday ? 'bg-emerald-500 border-emerald-500' : 'border-slate-200'}`}>
                                                    {habit.completedToday && <CheckCircle size={14} className="text-white" />}
                                                </div>
                                            </div>
                                            <h3 className="font-bold text-base md:text-lg text-slate-800">{habit.name}</h3>
                                            <div className="flex items-center gap-2 mt-2 text-xs md:text-sm text-slate-500">
                                                <span>{habit.category}</span><span>â€¢</span><span>{habit.streak} day streak</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                {/* Analysis */}
                                <div className="mt-8">
                                    <div className="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-2">
                                        <h3 className="text-lg md:text-xl font-bold text-[var(--primary)] flex items-center gap-2">
                                            <BarChart2 size={20} /> Full Analysis
                                        </h3>
                                        <div className="flex bg-slate-100 p-1 rounded-lg self-start md:self-auto">
                                            <button onClick={() => setAnalysisView('weekly')} className={`px-3 py-1 text-xs font-medium rounded-md transition-all ${analysisView === 'weekly' ? 'bg-white text-emerald-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Weekly</button>
                                            <button onClick={() => setAnalysisView('monthly')} className={`px-3 py-1 text-xs font-medium rounded-md transition-all ${analysisView === 'monthly' ? 'bg-white text-emerald-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Monthly</button>
                                        </div>
                                    </div>
                                    <Card>
                                        {analysisView === 'weekly' ? (
                                            <div>
                                                <h4 className="text-sm font-semibold text-slate-600 mb-6">Completion Rate (Last 7 Days)</h4>
                                                <SimpleBarChart data={[65, 80, 45, 90, 85, 95, 70]} labels={['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']} color="bg-emerald-400" />
                                            </div>
                                        ) : (
                                            <div>
                                                <h4 className="text-sm font-semibold text-slate-600 mb-6">Completion Rate (2025)</h4>
                                                <SimpleBarChart data={[70, 75, 80, 65, 85, 90, 88, 72, 80, 95, 85, 75]} labels={['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D']} color="bg-indigo-400" />
                                            </div>
                                        )}
                                    </Card>
                                </div>
                            </div>
                        );
                    case 'tasks':
                        return (
                            <div className="space-y-6 animate-fadeIn">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl md:text-2xl font-bold text-[var(--primary)]">My Tasks</h2>
                                    <button onClick={() => setIsTaskModalOpen(true)} className="flex items-center gap-2 bg-[var(--primary)] text-white px-3 py-2 rounded-xl hover:bg-[var(--secondary)] transition-colors text-sm font-medium">
                                        <Plus size={18} /> <span className="hidden md:inline">New Task</span>
                                    </button>
                                </div>
                                <Card>
                                    <div className="space-y-1">
                                        {tasks.length === 0 ? <div className="text-center py-10 text-slate-400">No tasks yet.</div> : tasks.map((task) => (
                                            <div key={task.id} className="group flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors border-b border-slate-50 last:border-0">
                                                <div className="flex items-center gap-4">
                                                    <button onClick={() => toggleTask(task.id)} className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${task.completed ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300 hover:border-indigo-400'}`}>
                                                        {task.completed && <CheckSquare size={14} className="text-white" />}
                                                    </button>
                                                    <div>
                                                        <p className={`font-medium ${task.completed ? 'text-slate-400 line-through' : 'text-slate-800'}`}>{task.title}</p>
                                                        <p className="text-xs text-slate-400 mt-0.5 flex items-center gap-2">
                                                            <span className={`px-1.5 py-0.5 rounded text-[10px] bg-slate-100 font-medium tracking-wide uppercase ${task.priority === 'High' ? 'text-red-600 bg-red-50' : 'text-slate-500'}`}>{task.priority}</span>
                                                            <span className="text-[10px] text-slate-400 flex items-center gap-1"><Calendar size={10} /> {task.due}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                                <button className="text-slate-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity" onClick={() => setTasks(tasks.filter(t => t.id !== task.id))}><X size={18} /></button>
                                            </div>
                                        ))}
                                    </div>
                                </Card>
                            </div>
                        );
                    case 'calendar':
                        return (
                            <div className="h-full flex flex-col items-center justify-center text-center space-y-4 animate-fadeIn py-12">
                                <div className="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center mb-4">
                                    <Calendar size={40} className="text-indigo-500" />
                                </div>
                                <h2 className="text-2xl font-bold text-[var(--primary)]">Calendar View 2026</h2>
                                <p className="text-slate-500 max-w-md">Your 2026 journey is being mapped out. Check back soon!</p>
                                <button onClick={() => setActiveTab('dashboard')} className="text-indigo-600 font-medium hover:underline mt-4">Return to Dashboard</button>
                            </div>
                        );
                    case 'settings':
                        return (
                            <div className="space-y-8 animate-fadeIn max-w-4xl mx-auto pb-12">
                                <h2 className="text-2xl font-bold text-[var(--primary)]">Settings</h2>
                                
                                {/* Theme Selection */}
                                <Card>
                                    <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2"><Layout size={20} className="text-indigo-500"/> Theme</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        {Object.entries(themes).map(([key, theme]) => (
                                            <button
                                                key={key}
                                                onClick={() => setCurrentTheme(key)}
                                                className={`p-4 rounded-xl border-2 flex flex-col items-center gap-3 transition-all ${currentTheme === key ? 'border-[var(--accent)] bg-slate-50' : 'border-slate-100 hover:border-slate-200'}`}
                                            >
                                                <div className="w-full h-12 rounded-lg shadow-sm flex overflow-hidden border border-slate-200">
                                                    <div className="w-1/3 h-full" style={{ backgroundColor: theme.colors.primary }}></div>
                                                    <div className="w-1/3 h-full" style={{ backgroundColor: theme.colors.secondary }}></div>
                                                    <div className="w-1/3 h-full" style={{ backgroundColor: theme.colors.bg }}></div>
                                                </div>
                                                <span className={`font-medium ${currentTheme === key ? 'text-[var(--primary)]' : 'text-slate-700'}`}>{theme.name}</span>
                                            </button>
                                        ))}
                                    </div>
                                </Card>

                                {/* Appearance */}
                                <Card>
                                    <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2"><ImageIcon size={20} className="text-indigo-500"/> Appearance</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <button 
                                            onClick={() => setAppTheme('light')}
                                            className={`p-4 rounded-xl border-2 flex flex-col items-center gap-3 transition-all ${appTheme === 'light' ? 'border-emerald-500 bg-emerald-50' : 'border-slate-100 hover:border-slate-200'}`}
                                        >
                                            <div className="w-full h-20 bg-[#f3f6f4] rounded-lg border border-slate-200 relative overflow-hidden shadow-inner">
                                                <div className="absolute top-3 left-3 w-16 h-6 bg-white rounded-md shadow-sm"></div>
                                                <div className="absolute top-12 left-3 w-10 h-2 bg-slate-200 rounded-full"></div>
                                            </div>
                                            <span className="font-medium text-slate-700">Light Mode</span>
                                        </button>
                                        <button 
                                            onClick={() => setAppTheme('dark')}
                                            className={`p-4 rounded-xl border-2 flex flex-col items-center gap-3 transition-all ${appTheme === 'dark' ? 'border-emerald-500 bg-slate-800' : 'border-slate-100 hover:border-slate-200'}`}
                                        >
                                            <div className="w-full h-20 bg-slate-900 rounded-lg border border-slate-700 relative overflow-hidden shadow-inner">
                                                <div className="absolute top-3 left-3 w-16 h-6 bg-slate-800 rounded-md shadow-sm border border-slate-700"></div>
                                                <div className="absolute top-12 left-3 w-10 h-2 bg-slate-700 rounded-full"></div>
                                            </div>
                                            <span className={`font-medium ${appTheme === 'dark' ? 'text-white' : 'text-slate-700'}`}>Dark Mode</span>
                                        </button>
                                    </div>
                                </Card>

                                {/* Security */}
                                <Card>
                                    <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2"><Lock size={20} className="text-emerald-500"/> Security & Privacy</h3>
                                    <div className="space-y-6">
                                        <div className="flex items-center justify-between p-2 hover:bg-slate-50 rounded-xl transition-colors">
                                            <div>
                                                <p className="font-medium text-slate-800">App Lock</p>
                                                <p className="text-sm text-slate-500">Require authentication to open ZenTrack</p>
                                            </div>
                                            <button 
                                                onClick={() => setSecuritySettings({...securitySettings, appLock: !securitySettings.appLock})}
                                                className={`w-12 h-6 rounded-full transition-colors relative ${securitySettings.appLock ? 'bg-emerald-500' : 'bg-slate-200'}`}
                                            >
                                                <div className={`absolute top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300 ${securitySettings.appLock ? 'translate-x-7' : 'translate-x-1'}`}></div>
                                            </button>
                                        </div>

                                        {securitySettings.appLock && (
                                            <div className="pl-4 border-l-2 border-slate-100 space-y-4 animate-fadeIn">
                                                <div className="flex items-center justify-between p-2 hover:bg-slate-50 rounded-xl transition-colors">
                                                    <div className="flex items-center gap-3">
                                                        <div className="p-2 bg-indigo-50 text-indigo-600 rounded-lg"><Fingerprint size={20}/></div>
                                                        <div>
                                                            <p className="font-medium text-slate-800">Biometric Unlock</p>
                                                            <p className="text-sm text-slate-500">Use fingerprint or Face ID</p>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={() => setSecuritySettings({...securitySettings, biometric: !securitySettings.biometric})}
                                                        className={`w-12 h-6 rounded-full transition-colors relative ${securitySettings.biometric ? 'bg-indigo-500' : 'bg-slate-200'}`}
                                                    >
                                                        <div className={`absolute top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300 ${securitySettings.biometric ? 'translate-x-7' : 'translate-x-1'}`}></div>
                                                    </button>
                                                </div>
                                                
                                                <button className="flex items-center gap-3 w-full p-3 hover:bg-slate-50 rounded-xl transition-colors text-left group">
                                                    <div className="p-2 bg-slate-100 text-slate-600 rounded-lg group-hover:bg-white group-hover:shadow-sm transition-all"><Key size={20}/></div>
                                                    <div className="flex-1">
                                                        <p className="font-medium text-slate-800">Change PIN</p>
                                                        <p className="text-sm text-slate-500">Update your 4-digit access code</p>
                                                    </div>
                                                    <ChevronRight size={16} className="text-slate-400 group-hover:translate-x-1 transition-transform"/>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </Card>
                            </div>
                        );
                    case 'focus':
                        return (
                            <div className="h-full flex flex-col animate-fadeIn space-y-6">
                                {/* Header for Focus Tab */}
                                <div className="flex items-center justify-between">
                                    <h2 className="text-2xl font-bold text-[#1b4332]">Focus Zone</h2>
                                    <div className="flex bg-slate-200 p-1 rounded-xl">
                                        <button 
                                            onClick={() => setFocusType('timer')}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${focusType === 'timer' ? 'bg-white text-[#1b4332] shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            Timer
                                        </button>
                                        <button 
                                            onClick={() => setFocusType('stopwatch')}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${focusType === 'stopwatch' ? 'bg-white text-[#1b4332] shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            Stopwatch
                                        </button>
                                    </div>
                                </div>

                                {/* Main Focus Card */}
                                <Card className="flex-1 flex flex-col items-center justify-center relative overflow-hidden bg-gradient-to-br from-[#1b4332] to-[#2d6a4f] text-white border-none shadow-xl min-h-[400px]">
                                    {/* Background Decoration */}
                                    <div className="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10 pointer-events-none">
                                        <div className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-white rounded-full blur-3xl transition-all duration-[4000ms] ${isTimerRunning || isStopwatchRunning ? 'scale-110 opacity-40' : 'scale-100 opacity-20'}`}></div>
                                    </div>

                                    <div className="z-10 flex flex-col items-center w-full max-w-md">
                                        {focusType === 'timer' ? (
                                            <>
                                                <div className="relative mb-10">
                                                    {/* Improved Timer Visual */}
                                                    <div className="w-72 h-72 rounded-full border-8 border-emerald-900/20 flex items-center justify-center relative shadow-2xl bg-[#1b4332]/50 backdrop-blur-sm">
                                                        <svg className="absolute inset-0 w-full h-full transform -rotate-90 overflow-visible" viewBox="0 0 100 100">
                                                        <circle 
                                                                cx="50" cy="50" r="46" 
                                                                stroke="currentColor" strokeWidth="3" fill="none" 
                                                                strokeDasharray={2 * Math.PI * 46}
                                                                strokeDashoffset={2 * Math.PI * 46 * (1 - timerTime / timerDuration)}
                                                                strokeLinecap="round"
                                                                className="text-emerald-400 transition-all duration-1000 ease-linear drop-shadow-[0_0_10px_rgba(52,211,153,0.6)]"
                                                        />
                                                    </svg>
                                                        <div className="flex flex-col items-center z-10">
                                                            <div className="text-7xl font-mono font-bold tracking-tighter text-white drop-shadow-md">{formatTime(timerTime)}</div>
                                                            <div className={`text-xs mt-2 font-bold uppercase tracking-[0.2em] px-3 py-1 rounded-full transition-colors ${isTimerRunning ? 'bg-emerald-500 text-white' : 'bg-white/10 text-emerald-200'}`}>
                                                                {isTimerRunning ? 'Focusing' : 'Paused'}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {/* Controls */}
                                                <div className="flex items-center gap-6 mb-8">
                                                    <button onClick={() => {setIsTimerRunning(false); setTimerTime(timerDuration);}} className="p-4 rounded-full bg-white/10 hover:bg-white/20 text-white transition-all backdrop-blur-sm"><RotateCcw size={24} /></button>
                                                    <button onClick={() => setIsTimerRunning(!isTimerRunning)} className="p-6 rounded-full bg-white text-[var(--primary)] hover:scale-105 transition-all shadow-lg shadow-emerald-900/20">
                                                        {isTimerRunning ? <Pause size={32} fill="currentColor" /> : <Play size={32} fill="currentColor" className="ml-1" />}
                                                    </button>
                                                </div>

                                                {/* Presets */}
                                                <div className="flex gap-3">
                                                    {[15, 25, 45, 60].map(min => (
                                                        <button 
                                                            key={min} 
                                                            onClick={() => { setTimerDuration(min * 60); setTimerTime(min * 60); setIsTimerRunning(false); }}
                                                            className={`px-4 py-2 rounded-lg text-sm font-medium border transition-all ${timerDuration === min * 60 ? 'bg-emerald-400/20 border-emerald-400 text-emerald-100' : 'border-white/10 text-emerald-200 hover:bg-white/5'}`}
                                                        >
                                                            {min}m
                                                        </button>
                                                    ))}
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                <div className="relative mb-12 flex flex-col items-center">
                                                    <div className="text-7xl font-mono font-bold tracking-tighter mb-4">{formatTime(stopwatchTime)}</div>
                                                    <div className="text-emerald-200 text-sm font-medium uppercase tracking-widest">Session Duration</div>
                                                </div>

                                                <div className="flex items-center gap-6">
                                                    <button onClick={() => {setIsStopwatchRunning(false); setStopwatchTime(0);}} className="p-4 rounded-full bg-white/10 hover:bg-white/20 text-white transition-all backdrop-blur-sm"><RotateCcw size={24} /></button>
                                                    <button onClick={() => setIsStopwatchRunning(!isStopwatchRunning)} className="p-6 rounded-full bg-white text-[var(--primary)] hover:scale-105 transition-all shadow-lg shadow-emerald-900/20">
                                                        {isStopwatchRunning ? <Pause size={32} fill="currentColor" /> : <Play size={32} fill="currentColor" className="ml-1" />}
                                                    </button>
                                                    <button onClick={() => {
                                                        setIsStopwatchRunning(false);
                                                        setTotalFocusTime(prev => prev + stopwatchTime);
                                                        setStopwatchTime(0);
                                                    }} className="p-4 rounded-full bg-emerald-500 hover:bg-emerald-400 text-white transition-all shadow-lg" title="Finish & Save">
                                                        <CheckSquare size={24} />
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                </Card>

                                {/* Total Focus Time Container */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <Card className="bg-indigo-50 border-indigo-100 flex items-center gap-4">
                                        <div className="p-3 bg-indigo-100 text-indigo-600 rounded-xl">
                                            <Activity size={24} />
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-500 font-medium">Total Focus Today</p>
                                            <h3 className="text-2xl font-bold text-slate-800">{Math.floor(totalFocusTime / 60)}m {totalFocusTime % 60}s</h3>
                                        </div>
                                    </Card>
                                    <Card className="bg-amber-50 border-amber-100 flex items-center gap-4">
                                        <div className="p-3 bg-amber-100 text-amber-600 rounded-xl">
                                            <Zap size={24} />
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-500 font-medium">Focus Sessions</p>
                                            <h3 className="text-2xl font-bold text-slate-800">
                                                {Math.ceil(totalFocusTime / (25 * 60))} <span className="text-sm font-normal text-slate-400">est. pomodoros</span>
                                            </h3>
                                        </div>
                                    </Card>
                                </div>
                            </div>
                        );
                    case 'screen-time':
                        const savedMinutes = Math.max(0, Math.floor(screenTimeData.total * (1 - ((Math.max(0, simulatorHour - 8)) / 16)) * 0.8));
                        const savedTimeStr = `${Math.floor(savedMinutes / 60)}h ${savedMinutes % 60}m`;
                        
                        return (
                            <div className="space-y-6 animate-fadeIn">
                                <h2 className="text-xl md:text-2xl font-bold text-[var(--primary)] flex items-center gap-2">
                                    <Monitor size={24} /> Screen Time & Wellbeing
                                </h2>
                                
                                {/* Top Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <Card className="bg-slate-900 text-white border-none">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="text-slate-400 text-sm font-medium">Total Screen Time</p>
                                                <h3 className="text-3xl font-bold mt-1">6h 25m</h3>
                                            </div>
                                            <div className="p-2 bg-slate-800 rounded-lg"><Clock size={20} className="text-emerald-400"/></div>
                                        </div>
                                        <div className="mt-4 flex items-center gap-2 text-sm">
                                            <span className="text-emerald-400 font-medium">-12%</span>
                                            <span className="text-slate-500">vs last week</span>
                                        </div>
                                    </Card>
                                    
                                    <Card>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium">Productive Ratio</p>
                                                <h3 className="text-3xl font-bold mt-1 text-slate-800">68%</h3>
                                            </div>
                                            <div className="p-2 bg-emerald-100 rounded-lg"><Zap size={20} className="text-emerald-600"/></div>
                                        </div>
                                        <div className="w-full bg-slate-100 h-2 mt-4 rounded-full overflow-hidden">
                                            <div className="h-full bg-emerald-500 w-[68%]"></div>
                                        </div>
                                        <p className="text-xs text-slate-400 mt-2">Target: 75%</p>
                                    </Card>

                                    <Card>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium">Digital Hygiene</p>
                                                <h3 className="text-3xl font-bold mt-1 text-slate-800">85<span className="text-lg text-slate-400 font-normal">/100</span></h3>
                                            </div>
                                            <div className="p-2 bg-indigo-100 rounded-lg"><Activity size={20} className="text-indigo-600"/></div>
                                        </div>
                                        <p className="text-xs text-slate-500 mt-4">Great job avoiding social media before 10 AM.</p>
                                    </Card>
                                </div>

                                {/* Middle Section */}
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    {/* Timeline & Apps */}
                                    <div className="lg:col-span-2 space-y-6">
                                        <Card>
                                            <h3 className="font-bold text-slate-800 mb-4">Session Timeline</h3>
                                            <div className="flex h-8 w-full rounded-lg overflow-hidden">
                                                <div className="bg-emerald-400 w-[30%]" title="Deep Work"></div>
                                                <div className="bg-slate-200 w-[5%]" title="Break"></div>
                                                <div className="bg-emerald-400 w-[25%]" title="Deep Work"></div>
                                                <div className="bg-amber-400 w-[15%]" title="Meeting"></div>
                                                <div className="bg-red-400 w-[10%]" title="Social Media"></div>
                                                <div className="bg-emerald-300 w-[15%]" title="Admin"></div>
                                            </div>
                                            <div className="flex justify-between text-xs text-slate-400 mt-2">
                                                <span>8:00 AM</span>
                                                <span>12:00 PM</span>
                                                <span>4:00 PM</span>
                                                <span>8:00 PM</span>
                                            </div>
                                            <div className="flex gap-4 mt-4 justify-center">
                                                <div className="flex items-center gap-2 text-xs font-medium text-slate-600"><div className="w-3 h-3 bg-emerald-400 rounded-full"></div> Productive</div>
                                                <div className="flex items-center gap-2 text-xs font-medium text-slate-600"><div className="w-3 h-3 bg-amber-400 rounded-full"></div> Communication</div>
                                                <div className="flex items-center gap-2 text-xs font-medium text-slate-600"><div className="w-3 h-3 bg-red-400 rounded-full"></div> Distraction</div>
                                            </div>
                                        </Card>

                                        <Card>
                                            <h3 className="font-bold text-slate-800 mb-4">App Usage Breakdown</h3>
                                            <div className="space-y-4">
                                                {screenTimeData.apps.map((app, i) => (
                                                    <div key={i} className="flex items-center gap-3">
                                                        <div className="w-8 h-8 flex items-center justify-center bg-slate-50 rounded-lg text-lg">{app.icon}</div>
                                                        <div className="flex-1">
                                                            <div className="flex justify-between mb-1">
                                                                <span className="text-sm font-medium text-slate-700">{app.name}</span>
                                                                <span className="text-xs text-slate-500">{Math.floor(app.time / 60)}h {app.time % 60}m</span>
                                                            </div>
                                                            <div className="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                                                                <div 
                                                                    className={`h-full rounded-full ${app.type === 'productive' ? 'bg-emerald-500' : app.type === 'distraction' ? 'bg-red-400' : 'bg-amber-400'}`} 
                                                                    style={{ width: `${(app.time / 180) * 100}%` }}
                                                                ></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </Card>
                                    </div>

                                    {/* Focus Overlay & Context Switching */}
                                    <div className="space-y-6">
                                        <Card>
                                            <h3 className="font-bold text-slate-800 mb-4">Content Breakdown</h3>
                                            <div className="space-y-4">
                                                <div>
                                                    <div className="flex justify-between text-xs mb-1">
                                                        <span className="font-medium text-slate-600">Social Media</span>
                                                        <span className="text-slate-400">45m</span>
                                                    </div>
                                                    <div className="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                                        <div className="h-full bg-pink-400 w-[35%]"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className="flex justify-between text-xs mb-1">
                                                        <span className="font-medium text-slate-600">Video Streaming</span>
                                                        <span className="text-slate-400">60m</span>
                                                    </div>
                                                    <div className="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                                        <div className="h-full bg-red-500 w-[48%]"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className="flex justify-between text-xs mb-1">
                                                        <span className="font-medium text-slate-600">Other</span>
                                                        <span className="text-slate-400">20m</span>
                                                    </div>
                                                    <div className="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                                        <div className="h-full bg-amber-400 w-[17%]"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </Card>

                                        <Card className="bg-gradient-to-br from-indigo-50 to-white">
                                            <h3 className="font-bold text-slate-800 mb-2">Context Switching</h3>
                                            <div className="flex items-end gap-2 mb-2">
                                                <span className="text-4xl font-bold text-indigo-900">{screenTimeData.switches}</span>
                                                <span className="text-sm text-indigo-700 mb-1">switches today</span>
                                            </div>
                                            <p className="text-xs text-slate-500 mb-4">High fragmentation detected between 2 PM - 4 PM.</p>
                                            <div className="h-24 flex items-end gap-1">
                                                {[4, 8, 3, 12, 15, 8, 5, 2].map((h, i) => (
                                                    <div key={i} className="flex-1 bg-indigo-200 rounded-t-sm hover:bg-indigo-400 transition-colors" style={{ height: `${h * 5}%` }}></div>
                                                ))}
                                            </div>
                                        </Card>

                                        <Card>
                                            <h3 className="font-bold text-slate-800 mb-4">Fatigue Curve</h3>
                                            <div className="relative h-32 w-full">
                                                <svg className="w-full h-full overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
                                                    {/* Mock Curve */}
                                                    <path d="M0,90 Q20,80 40,60 T80,30 T100,10" fill="none" stroke="#f43f5e" strokeWidth="3" strokeLinecap="round" />
                                                    <path d="M0,90 L100,90" stroke="#e2e8f0" strokeWidth="1" strokeDasharray="4 4" />
                                                </svg>
                                                <div className="absolute bottom-0 left-0 text-[10px] text-slate-400">8 AM</div>
                                                <div className="absolute bottom-0 right-0 text-[10px] text-slate-400">8 PM</div>
                                                <div className="absolute top-0 right-0 text-[10px] text-rose-500 font-bold">High Fatigue</div>
                                            </div>
                                            <p className="text-xs text-slate-500 mt-2">Cognitive load peaks at 4 PM. Consider a break.</p>
                                        </Card>
                                    </div>
                                </div>

                                {/* Bottom: Simulator */}
                                <Card className="bg-slate-800 text-white overflow-hidden relative">
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl -mr-16 -mt-16"></div>
                                    <div className="relative z-10">
                                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                            <div>
                                                <h3 className="text-lg font-bold flex items-center gap-2"><Coffee size={20} className="text-amber-400"/> "If I stopped at..." Simulator</h3>
                                                <p className="text-slate-400 text-sm">See how stopping earlier affects your wellbeing.</p>
                                            </div>
                                            <div className="mt-4 md:mt-0 text-right">
                                                <div className="text-3xl font-bold text-emerald-400">{savedTimeStr}</div>
                                                <div className="text-xs text-slate-400">Potential time reclaimed</div>
                                            </div>
                                        </div>

                                        <div className="space-y-6">
                                            <div>
                                                <div className="flex justify-between text-sm font-medium mb-2">
                                                    <span className="text-slate-300">Stop work at: <span className="text-white text-lg">{simulatorHour}:00</span></span>
                                                </div>
                                                <input 
                                                    type="range" 
                                                    min="12" 
                                                    max="24" 
                                                    step="1" 
                                                    value={simulatorHour} 
                                                    onChange={(e) => setSimulatorHour(parseInt(e.target.value))}
                                                    className="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                                                />
                                                <div className="flex justify-between text-xs text-slate-500 mt-2">
                                                    <span>12:00 PM</span>
                                                    <span>6:00 PM</span>
                                                    <span>12:00 AM</span>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t border-slate-700">
                                                <div>
                                                    <p className="text-xs text-slate-400">Fatigue Reduction</p>
                                                    <p className="text-lg font-bold text-emerald-300">-{Math.round((24 - simulatorHour) * 3.5)}%</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-slate-400">Sleep Quality</p>
                                                    <p className="text-lg font-bold text-indigo-300">+{Math.round((24 - simulatorHour) * 4.2)}%</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-slate-400">Books Read (Year)</p>
                                                    <p className="text-lg font-bold text-amber-300">+{Math.round((24 - simulatorHour) * 1.5)}</p>
                                                </div>
                                                 <div>
                                                    <p className="text-xs text-slate-400">Family Time</p>
                                                    <p className="text-lg font-bold text-pink-300">+{Math.floor((24 - simulatorHour) * 0.8)}h</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </Card>
                            </div>
                        );
                    case 'notes':
                        return (
                            <div className="space-y-6 animate-fadeIn h-full flex flex-col">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl md:text-2xl font-bold text-[var(--primary)]">My Notes</h2>
                                    {notesView === 'list' && (
                                        <button onClick={() => openNoteEditor()} className="flex items-center gap-2 bg-[var(--primary)] text-white px-3 py-2 rounded-xl hover:bg-[var(--secondary)] transition-colors text-sm font-medium">
                                            <Plus size={18} /> New Note
                                        </button>
                                    )}
                                </div>
                                {notesView === 'list' ? (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {notes.map(note => (
                                            <div key={note.id} onClick={() => openNoteEditor(note)} className="group bg-white p-6 rounded-2xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-md transition-all hover:border-indigo-100 flex flex-col h-48">
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className={`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${note.category === 'Journal' ? 'bg-purple-100 text-purple-700' : note.category === 'Ideas' ? 'bg-amber-100 text-amber-700' : note.category === 'Work' ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-700'}`}>{note.category}</span>
                                                    <button onClick={(e) => { e.stopPropagation(); handleDeleteNote(note.id); }} className="text-slate-300 hover:text-red-400 p-1 rounded-full hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100"><Trash2 size={16} /></button>
                                                </div>
                                                <h3 className="font-bold text-lg text-slate-800 mb-2 truncate">{note.title}</h3>
                                                <p className="text-sm text-slate-500 flex-1 overflow-hidden line-clamp-3 leading-relaxed">{note.content}</p>
                                                <div className="pt-4 mt-2 border-t border-slate-50 text-xs text-slate-400 flex items-center justify-between">
                                                    <span>{note.date}</span>
                                                    <span className="group-hover:translate-x-1 transition-transform text-indigo-400"><Edit3 size={14} /></span>
                                                </div>
                                            </div>
                                        ))}
                                        {notes.length === 0 && (
                                            <div className="col-span-full py-12 flex flex-col items-center justify-center text-slate-400 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                                                <FileText size={48} className="mb-4 opacity-50" />
                                                <p>No notes yet. Start writing your thoughts!</p>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <Card className="flex-1 flex flex-col h-full overflow-hidden">
                                        <div className="flex flex-col md:flex-row md:items-center gap-4 mb-6 pb-4 border-b border-slate-100">
                                            <div className="flex items-center gap-4 w-full">
                                                <button onClick={() => setNotesView('list')} className="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-500"><ArrowLeft size={20} /></button>
                                                <input type="text" placeholder="Note Title..." value={noteForm.title} onChange={(e) => setNoteForm({...noteForm, title: e.target.value})} className="flex-1 text-lg md:text-xl font-bold bg-transparent border-none focus:ring-0 placeholder:text-slate-300 text-[var(--primary)]" />
                                            </div>
                                            <div className="flex gap-2 w-full md:w-auto justify-end">
                                                <button onClick={handleAddImage} className="p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors" title="Add Image"><ImageIcon size={20} /></button>
                                                <select value={noteForm.category} onChange={(e) => setNoteForm({...noteForm, category: e.target.value})} className="text-sm border-none bg-slate-50 rounded-lg px-3 py-2 text-slate-600 focus:ring-2 focus:ring-indigo-200">
                                                    <option>Journal</option><option>Ideas</option><option>Work</option><option>Personal</option>
                                                </select>
                                                <button onClick={handleSaveNote} className="flex items-center gap-2 bg-[var(--primary)] text-white px-4 py-2 rounded-lg hover:bg-[var(--secondary)] transition-all shadow-lg shadow-emerald-900/10 text-sm font-medium"><Save size={18} /> Save</button>
                                            </div>
                                        </div>
                                        <textarea placeholder="Start typing your thoughts here..." value={noteForm.content} onChange={(e) => setNoteForm({...noteForm, content: e.target.value})} className="flex-1 w-full resize-none border-none focus:ring-0 text-slate-700 leading-relaxed text-base md:text-lg bg-transparent p-0 custom-scrollbar"></textarea>
                                    </Card>
                                )}
                            </div>
                        );
                    default:
                        // Dashboard
                        return (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 h-full animate-fadeIn pb-12">
                                <div className="lg:col-span-2 space-y-6">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl md:text-2xl font-bold text-[var(--primary)] flex items-center gap-2">
                                            <Leaf size={24} className="text-[#52b788]" /> My Habits
                                        </h2>
                                        <button onClick={() => setIsHabitModalOpen(true)} className="flex items-center gap-2 text-sm font-medium text-[var(--primary)] hover:bg-emerald-50 px-3 py-2 rounded-lg transition-colors">
                                            <Plus size={16} /> New Habit
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {habits.map((habit) => (
                                            <div key={habit.id} onClick={() => toggleHabit(habit.id)} className={`group relative p-5 rounded-2xl cursor-pointer transition-all duration-300 border-2 ${habit.completedToday ? 'bg-white border-emerald-100 shadow-sm' : 'bg-white border-transparent shadow-sm hover:shadow-md hover:-translate-y-1'}`}>
                                                <div className="flex justify-between items-start">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center ${habit.color} bg-opacity-30`}>
                                                            {habit.category === 'Mind' && <span className="text-xl">ðŸ§˜â€â™€ï¸</span>}
                                                            {habit.category === 'Body' && <span className="text-xl">ðŸƒâ€â™€ï¸</span>}
                                                            {habit.category === 'Growth' && <span className="text-xl">ðŸ“š</span>}
                                                            {habit.category === 'Health' && <span className="text-xl">ðŸ’§</span>}
                                                        </div>
                                                        <div>
                                                            <h4 className={`font-bold text-base md:text-lg ${habit.completedToday ? 'text-slate-500 line-through' : 'text-slate-800'}`}>{habit.name}</h4>
                                                            <span className="text-xs font-medium text-slate-400 bg-slate-50 px-2 py-0.5 rounded-md mt-1 inline-block">{habit.streak} day streak ðŸ”¥</span>
                                                        </div>
                                                    </div>
                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 ${habit.completedToday ? 'bg-emerald-500 text-white scale-110' : 'bg-slate-100 text-slate-300 group-hover:bg-emerald-100 group-hover:text-emerald-500'}`}>
                                                        <CheckCircle size={18} fill={habit.completedToday ? "currentColor" : "none"} />
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    {/* Motivation */}
                                    <div className="mt-8 bg-gradient-to-r from-indigo-50 to-emerald-50 rounded-2xl p-6 border border-indigo-100 flex flex-col md:flex-row gap-4 items-start relative overflow-hidden">
                                        <div className="bg-white p-3 rounded-full shadow-sm z-10 shrink-0"><Quote className="text-indigo-400" size={24} /></div>
                                        <div className="z-10">
                                            <p className="text-lg font-medium text-slate-800 italic">"Discipline is doing what needs to be done, even if you don't want to do it."</p>
                                            <p className="text-sm text-slate-500 mt-2 font-medium">â€” Daily Wisdom</p>
                                        </div>
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-200/20 rounded-full -mr-10 -mt-10 blur-xl"></div>
                                    </div>
                                    {/* 2026 Progress */}
                                    <div className="mt-8">
                                        <div className="flex justify-between items-end mb-2">
                                            <h3 className="font-bold text-[var(--primary)]">{is2026 ? "2026 Progress" : "Countdown to 2026"}</h3>
                                            <span className="text-sm font-medium text-emerald-600">{yearProgress}%</span>
                                        </div>
                                        <div className="w-full h-4 bg-slate-200 rounded-full overflow-hidden shadow-inner">
                                            <div className="h-full bg-gradient-to-r from-emerald-400 to-indigo-500 transition-all duration-1000 ease-out relative" style={{ width: `${yearProgress}%` }}>
                                                <div className="absolute top-0 left-0 w-full h-full bg-white/20 animate-pulse"></div>
                                            </div>
                                        </div>
                                        <p className="text-xs text-slate-400 mt-2 text-right">{is2026 ? "Make every day count." : "Prepare for your best year yet."}</p>
                                    </div>
                                </div>
                                {/* Sidebar Tasks */}
                                <div className="lg:col-span-1">
                                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 h-full flex flex-col">
                                        <div className="flex items-center justify-between mb-6">
                                            <h2 className="text-lg font-bold text-[var(--primary)]">Today's Tasks</h2>
                                            <button className="text-slate-400 hover:text-[var(--primary)] transition-colors"><MoreHorizontal size={20} /></button>
                                        </div>
                                        <div className="flex-1 space-y-3 overflow-y-auto pr-2 custom-scrollbar min-h-[200px]">
                                            {tasks.map((task) => (
                                                <div key={task.id} className={`p-4 rounded-xl border transition-all duration-200 ${task.completed ? 'bg-slate-50 border-transparent opacity-60' : 'bg-white border-slate-100 hover:border-indigo-200 hover:shadow-sm'}`}>
                                                    <div className="flex items-start gap-3">
                                                        <button onClick={() => toggleTask(task.id)} className={`mt-1 min-w-[20px] h-5 rounded border flex items-center justify-center transition-colors ${task.completed ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300 hover:border-indigo-400'}`}>
                                                            {task.completed && <CheckSquare size={14} className="text-white" />}
                                                        </button>
                                                        <div className="flex-1">
                                                            <p className={`text-sm font-medium ${task.completed ? 'text-slate-500 line-through' : 'text-slate-800'}`}>{task.title}</p>
                                                            <div className="flex items-center gap-2 mt-2">
                                                                <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium ${task.priority === 'High' ? 'bg-pink-100 text-pink-700' : task.priority === 'Medium' ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-600'}`}>{task.priority}</span>
                                                                <span className="text-[10px] text-slate-400 flex items-center gap-1"><Calendar size={10} /> {task.due}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            <button onClick={() => setIsTaskModalOpen(true)} className="w-full py-3 border-2 border-dashed border-slate-200 rounded-xl text-slate-400 font-medium text-sm hover:border-indigo-300 hover:text-indigo-500 transition-colors flex items-center justify-center gap-2">
                                                <Plus size={16} /> Add New Task
                                            </button>
                                        </div>
                                        <div className="mt-6 p-4 bg-gradient-to-br from-[#c8b6ff] to-[#b8c0ff] rounded-xl relative overflow-hidden text-white shrink-0">
                                            <div className="relative z-10">
                                                <h4 className="font-bold text-sm text-[#3a2a6e]">2026 Goal</h4>
                                                <p className="text-xs text-[#3a2a6e]/80 mt-1">Keep up the momentum for your best year yet!</p>
                                            </div>
                                            <Leaf className="absolute -bottom-2 -right-2 text-white/30 rotate-12" size={60} />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="flex h-screen bg-[var(--bg-main)] font-sans text-slate-800 overflow-hidden">
                    
                    {/* Sidebar - Desktop */}
                    <aside className="hidden lg:flex w-64 bg-[var(--primary)] text-white flex-col justify-between transition-all duration-300 shadow-xl z-20 relative">
                        <div className="flex-1">
                            <div className="h-20 flex items-center justify-start px-8 border-b border-[var(--secondary)] cursor-pointer" onClick={() => setActiveTab('dashboard')}>
                                <div className="bg-emerald-400 p-2 rounded-lg">
                                    <Leaf size={24} className="text-[var(--primary)]" />
                                </div>
                                <span className="ml-3 font-bold text-xl tracking-tight text-emerald-50">ZenTrack</span>
                            </div>

                            <nav className="mt-8 flex flex-col gap-2 px-3">
                                {navItems.map((item) => (
                                    <button
                                        key={item.id}
                                        onClick={() => setActiveTab(item.id)}
                                        className={`flex items-center p-3 rounded-xl transition-all duration-200 group ${
                                            activeTab === item.id 
                                                ? 'bg-[var(--accent)] text-white shadow-lg shadow-emerald-900/20' 
                                                : 'text-emerald-100 hover:bg-[var(--secondary)] hover:text-white'
                                        }`}
                                    >
                                        <item.icon size={20} className={activeTab === item.id ? 'text-white' : 'text-emerald-200 group-hover:text-white'} />
                                        <span className="ml-3 font-medium">{item.label}</span>
                                    </button>
                                ))}
                            </nav>
                        </div>

                        {/* Sidebar Bottom Section (Settings & Profile) */}
                        <div className="p-4 border-t border-[var(--secondary)] bg-[var(--sidebar-bottom)]">
                            {/* Profile Section (Desktop) */}
                            <div className="relative" ref={desktopProfileRef}>
                                <div 
                                    onClick={() => setIsDesktopProfileOpen(!isDesktopProfileOpen)}
                                    className="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--secondary)] cursor-pointer transition-colors"
                                >
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-300 to-purple-300 border-2 border-[var(--accent)] flex items-center justify-center shrink-0 overflow-hidden">
                                        {profileImage ? <img src={profileImage} alt="Profile" className="w-full h-full object-cover" /> : <User size={18} className="text-[var(--primary)]" />}
                                    </div>
                                    <div className="flex-1 overflow-hidden">
                                        <p className="text-sm font-bold text-white truncate">{profileData.name}</p>
                                    </div>
                                    <MoreVertical size={16} className="text-emerald-400" />
                                </div>

                                {isDesktopProfileOpen && (
                                    <div className="absolute bottom-full left-0 w-60 bg-white rounded-xl shadow-2xl border border-slate-100 mb-2 p-2 animate-in fade-in slide-in-from-bottom-2 z-50">
                                        <div className="px-4 py-3 border-b border-slate-50 mb-1">
                                            <p className="text-sm font-bold text-slate-800">{profileData.name}</p>
                                            <p className="text-xs text-slate-400">{profileData.email}</p>
                                        </div>
                                        <button onClick={() => { setIsDesktopProfileOpen(false); setIsEditProfileModalOpen(true); }} className="w-full text-left px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 flex items-center gap-2 rounded-lg"><User size={16} /> Edit Profile</button>
                                        <button onClick={() => { setIsDesktopProfileOpen(false); setActiveTab('settings'); }} className="w-full text-left px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 flex items-center gap-2 rounded-lg"><Settings size={16} /> Settings</button>
                                        <button className="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 flex items-center gap-2 rounded-lg"><LogOut size={16} /> Sign Out</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </aside>

                    {/* Mobile Bottom Navigation - Auto Hide */}
                    <nav 
                        className={`lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 z-[40] flex justify-around items-center p-2 safe-area-bottom shadow-[0_-5px_15px_rgba(0,0,0,0.05)] transition-transform duration-300 ease-in-out ${
                            isNavVisible ? 'translate-y-0' : 'translate-y-full'
                        }`}
                    >
                        {navItems.filter(item => item.id !== 'calendar').map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${
                                    activeTab === item.id 
                                        ? 'text-[var(--primary)]' 
                                        : 'text-slate-400 hover:text-slate-600'
                                }`}
                            >
                                <item.icon size={20} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                                <span className="text-[10px] font-medium mt-1">{item.label}</span>
                            </button>
                        ))}
                        <button
                            ref={moreBtnRef}
                            onClick={() => setIsMoreMenuOpen(!isMoreMenuOpen)}
                            className={`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${
                                isMoreMenuOpen ? 'text-[var(--primary)]' : 'text-slate-400 hover:text-slate-600'
                            }`}
                        >
                            <MoreHorizontal size={20} strokeWidth={isMoreMenuOpen ? 2.5 : 2} />
                            <span className="text-[10px] font-medium mt-1">More</span>
                        </button>
                    </nav>

                    {/* Mobile More Menu */}
                    {isMoreMenuOpen && (
                        <div ref={moreMenuRef} className="lg:hidden fixed bottom-20 right-4 z-[50] bg-white rounded-xl shadow-xl border border-slate-100 p-2 animate-in fade-in slide-in-from-bottom-2 w-48">
                            <button 
                                onClick={() => { setActiveTab('calendar'); setIsMoreMenuOpen(false); }}
                                className={`w-full flex items-center gap-3 p-3 rounded-lg transition-all ${activeTab === 'calendar' ? 'bg-indigo-50 text-indigo-600' : 'text-slate-600 hover:bg-slate-50'}`}
                            >
                                <Calendar size={20} />
                                <span className="font-medium">2026</span>
                            </button>
                        </div>
                    )}

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col overflow-hidden relative">
                        {/* Top Header - High Z-Index for Dropdown Visibility */}
                        {activeTab === 'dashboard' && (
                            <header className="h-24 md:h-28 bg-white border-b border-slate-100 flex items-center justify-between px-4 lg:px-8 z-[50] shrink-0 relative">
                                <div>
                                    <div className="flex items-center gap-2 text-emerald-600 font-semibold mb-1 text-sm md:text-base tracking-wide uppercase">
                                        <Calendar size={16} />
                                        <span>{currentDate.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</span>
                                    </div>
                                    <h1 className="text-2xl md:text-3xl font-bold text-[var(--primary)]">Hello, {profileData.name.split(' ')[0]}</h1>
                                </div>
                                <div className="flex items-center gap-3 md:gap-6">
                                    <div className="relative hidden md:block">
                                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                                        <input 
                                            type="text" 
                                            placeholder="Search tasks & habits..." 
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            className="pl-10 pr-4 py-2 rounded-full bg-slate-50 border-none focus:ring-2 focus:ring-[#95d5b2] outline-none text-sm w-64 transition-all" 
                                        />
                                        {searchQuery && (
                                            <div className="absolute left-0 top-full mt-2 w-80 bg-white rounded-xl shadow-xl border border-slate-100 py-2 animate-in fade-in slide-in-from-top-2 z-[60]">
                                                {searchResults.length > 0 ? (
                                                    searchResults.map(item => (
                                                        <div key={item.id + item.type} onClick={() => {
                                                            if(item.type === 'task') { setActiveTab('tasks'); }
                                                            else { setActiveTab('habits'); }
                                                            setSearchQuery('');
                                                        }} className="px-4 py-3 hover:bg-slate-50 transition-colors cursor-pointer border-b border-slate-50 last:border-0 flex items-center gap-3">
                                                            {item.type === 'task' ? <CheckSquare size={16} className="text-indigo-500"/> : <Activity size={16} className="text-emerald-500"/>}
                                                            <div>
                                                                <p className="text-sm font-medium text-slate-800">{item.type === 'task' ? item.title : item.name}</p>
                                                                <p className="text-xs text-slate-500 capitalize">{item.type}</p>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div className="px-4 py-3 text-sm text-slate-500 text-center">No results found.</div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    <div className="relative" ref={notificationRef}>
                                        <button onClick={() => setIsNotificationsOpen(!isNotificationsOpen)} className="relative p-2 rounded-full hover:bg-slate-50 transition-colors">
                                            <Bell size={20} className="text-slate-600" />
                                            <span className="absolute top-1 right-1 w-2 h-2 bg-pink-400 rounded-full border border-white"></span>
                                        </button>
                                        {isNotificationsOpen && (
                                            <div className="absolute right-0 top-12 w-80 bg-white rounded-xl shadow-xl border border-slate-100 py-2 animate-in fade-in slide-in-from-top-2 z-[60]">
                                                <div className="px-4 py-2 border-b border-slate-50 flex justify-between items-center">
                                                    <h3 className="font-bold text-slate-800">Notifications</h3>
                                                    <button className="text-xs text-indigo-500 hover:underline">Mark all read</button>
                                                </div>
                                                <div className="max-h-64 overflow-y-auto custom-scrollbar">
                                                    <div className="px-4 py-3 hover:bg-slate-50 transition-colors cursor-pointer border-b border-slate-50 last:border-0">
                                                        <p className="text-sm font-medium text-slate-800">Drink Water Reminder</p>
                                                        <p className="text-xs text-slate-500 mt-1">It's been 2 hours since your last glass.</p>
                                                        <p className="text-[10px] text-slate-400 mt-1">10 min ago</p>
                                                    </div>
                                                    <div className="px-4 py-3 hover:bg-slate-50 transition-colors cursor-pointer border-b border-slate-50 last:border-0">
                                                        <p className="text-sm font-medium text-slate-800">Task Due Soon</p>
                                                        <p className="text-xs text-slate-500 mt-1">"2026 Vision Board" is due at 2:00 PM.</p>
                                                        <p className="text-[10px] text-slate-400 mt-1">1 hour ago</p>
                                                    </div>
                                                    <div className="px-4 py-3 hover:bg-slate-50 transition-colors cursor-pointer">
                                                        <p className="text-sm font-medium text-slate-800">Weekly Report Ready</p>
                                                        <p className="text-xs text-slate-500 mt-1">Your productivity analysis for last week is available.</p>
                                                        <p className="text-[10px] text-slate-400 mt-1">Yesterday</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    {/* Mobile Only Profile Button */}
                                    <div className="relative lg:hidden">
                                        <button onClick={() => setIsProfileOpen(!isProfileOpen)} className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-indigo-300 to-purple-300 border-2 border-white shadow-md flex items-center justify-center hover:shadow-lg transition-all">
                                            {!isProfileOpen && <span className="sr-only">Open Profile</span>}
                                        </button>
                                        {isProfileOpen && (
                                            <div className="absolute right-0 top-12 w-48 bg-white rounded-xl shadow-xl border border-slate-100 py-2 animate-in fade-in slide-in-from-top-2 z-[60]">
                                                <div className="px-4 py-2 border-b border-slate-50 mb-1">
                                                    <p className="text-sm font-bold text-slate-800">{profileData.name}</p>
                                                    <p className="text-xs text-slate-400">{profileData.email}</p>
                                                </div>
                                                <button onClick={() => { setIsProfileOpen(false); setIsEditProfileModalOpen(true); }} className="w-full text-left px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 flex items-center gap-2"><User size={16} /> Edit Profile</button>
                                                <button onClick={() => { setIsProfileOpen(false); setActiveTab('settings'); }} className="w-full text-left px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 flex items-center gap-2"><Settings size={16} /> Settings</button>
                                                <button className="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 flex items-center gap-2"><LogOut size={16} /> Logout</button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </header>
                        )}

                        {/* Background Watermark */}
                        <div className="absolute inset-0 z-0 flex items-center justify-center pointer-events-none overflow-hidden">
                            <span className="text-[18vw] font-bold text-[var(--primary)] opacity-[0.08] select-none -rotate-12 transform origin-center whitespace-nowrap">
                                {currentDate.toLocaleDateString('en-US', { weekday: 'long' })}
                            </span>
                        </div>

                        {/* Dashboard Content Container */}
                        <div 
                            ref={scrollContainerRef}
                            className="flex-1 overflow-y-auto p-4 lg:p-8 custom-scrollbar relative z-10 pb-32 lg:pb-8"
                        >
                            <div className="max-w-7xl mx-auto space-y-6 md:space-y-8 h-full">
                                {activeTab === 'dashboard' && (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                        <Card className="flex flex-col md:flex-row items-center justify-between relative overflow-hidden bg-gradient-to-br from-[#e0c3fc] to-[#8ec5fc] text-white border-none shadow-lg">
                                            <div className="z-10 text-white text-center md:text-left mb-4 md:mb-0">
                                                <h3 className="text-lg font-semibold mb-1 text-indigo-900">Daily Focus</h3>
                                                <p className="text-indigo-800/80 text-sm mb-4">You're doing great!</p>
                                                <div className="flex items-baseline gap-2 justify-center md:justify-start">
                                                    <span className="text-4xl font-bold text-indigo-900">{completedHabitsCount}</span>
                                                    <span className="text-indigo-800">/ {habits.length} Habits</span>
                                                </div>
                                            </div>
                                            <div className="z-10 bg-white/20 p-2 rounded-full backdrop-blur-sm">
                                                <ProgressCircle percentage={progressPercentage} color="var(--primary)" size={80} strokeWidth={8} />
                                            </div>
                                            <div className="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                                            <div className="absolute -bottom-10 -left-10 w-40 h-40 bg-indigo-500/10 rounded-full blur-2xl"></div>
                                        </Card>

                                        <Card className="border-l-4 border-l-emerald-500">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 className="font-semibold text-slate-700">Consistency</h3>
                                                    <p className="text-xs text-slate-400">Last 7 Days</p>
                                                </div>
                                                <TrendingUp className="text-emerald-500" size={20} />
                                            </div>
                                            <div className="h-12 w-full mb-2">
                                                <MiniSparkline data={[50, 70, 60, 90, 80, 95, 85]} color="#10b981" />
                                            </div>
                                            <div className="text-sm font-medium text-emerald-600">+12% vs last week</div>
                                        </Card>

                                        <Card className="border-l-4 border-l-purple-400">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 className="font-semibold text-slate-700">Pending Tasks</h3>
                                                    <p className="text-xs text-slate-400">Due today</p>
                                                </div>
                                                <CheckCircle className="text-purple-400" size={20} />
                                            </div>
                                            <div className="flex items-end gap-2">
                                                <span className="text-4xl font-bold text-slate-700">{tasks.filter(t => !t.completed).length}</span>
                                                <span className="text-sm text-slate-400 mb-1">remaining</span>
                                            </div>
                                            <div className="w-full bg-slate-100 h-1.5 mt-4 rounded-full overflow-hidden">
                                                <div className="h-full bg-purple-400 w-2/3 rounded-full"></div>
                                            </div>
                                        </Card>
                                    </div>
                                )}
                                {renderContent()}
                            </div>
                        </div>
                    </main>

                    {/* Add Habit Modal */}
                    <Modal isOpen={isHabitModalOpen} onClose={() => setIsHabitModalOpen(false)} title="Add New Habit">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Habit Name</label>
                                <input type="text" placeholder="e.g., Read for 15 mins" value={newHabit.name} onChange={(e) => setNewHabit({...newHabit, name: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Category</label>
                                <div className="flex gap-2">
                                    {['Health', 'Mind', 'Body', 'Growth'].map(cat => (
                                        <button key={cat} onClick={() => setNewHabit({...newHabit, category: cat})} className={`px-3 py-1.5 rounded-lg text-sm border transition-all ${newHabit.category === cat ? 'bg-emerald-100 border-emerald-500 text-emerald-800' : 'border-slate-200 text-slate-500 hover:border-emerald-200'}`}>{cat}</button>
                                    ))}
                                </div>
                            </div>
                            <button onClick={addHabit} className="w-full bg-[var(--primary)] text-white py-3 rounded-xl font-bold hover:bg-[var(--secondary)] transition-all mt-4 shadow-lg shadow-emerald-900/10">Create Habit</button>
                        </div>
                    </Modal>

                    {/* Add Task Modal */}
                    <Modal isOpen={isTaskModalOpen} onClose={() => setIsTaskModalOpen(false)} title="Add New Task">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Task Title</label>
                                <input type="text" placeholder="e.g., Submit monthly report" value={newTask.title} onChange={(e) => setNewTask({...newTask, title: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Priority</label>
                                    <select value={newTask.priority} onChange={(e) => setNewTask({...newTask, priority: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 bg-white">
                                        <option>Low</option><option>Medium</option><option>High</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Due Date</label>
                                    <select value={newTask.due} onChange={(e) => setNewTask({...newTask, due: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 bg-white">
                                        <option>Today</option><option>Tomorrow</option><option>This Week</option>
                                    </select>
                                </div>
                            </div>
                            <button onClick={addTask} className="w-full bg-[var(--primary)] text-white py-3 rounded-xl font-bold hover:bg-[var(--secondary)] transition-all mt-4 shadow-lg shadow-emerald-900/10">Add Task</button>
                        </div>
                    </Modal>

                    {/* Edit Profile Modal */}
                    <Modal isOpen={isEditProfileModalOpen} onClose={() => setIsEditProfileModalOpen(false)} title="Edit Profile">
                        <div className="space-y-4">
                            <div className="flex justify-center mb-6">
                                <div className="relative">
                                    <div className="w-24 h-24 rounded-full bg-gradient-to-br from-indigo-300 to-purple-300 border-4 border-white shadow-lg flex items-center justify-center text-3xl text-white font-bold overflow-hidden">
                                        {profileImage ? (
                                            <img src={profileImage} alt="Profile" className="w-full h-full object-cover" />
                                        ) : (
                                            profileData.name.charAt(0)
                                        )}
                                    </div>
                                    <input type="file" ref={fileInputRef} onChange={handleImageUpload} className="hidden" accept="image/*" />
                                    <button onClick={() => fileInputRef.current.click()} className="absolute bottom-0 right-0 p-2 bg-slate-800 text-white rounded-full shadow-md hover:bg-slate-700"><ImageIcon size={14}/></button>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
                                <input type="text" value={profileData.name} onChange={(e) => setProfileData({...profileData, name: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Email</label>
                                <input type="email" value={profileData.email} onChange={(e) => setProfileData({...profileData, email: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Bio / Title</label>
                                <input type="text" value={profileData.bio} onChange={(e) => setProfileData({...profileData, bio: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <button onClick={() => setIsEditProfileModalOpen(false)} className="w-full bg-[var(--primary)] text-white py-3 rounded-xl font-bold hover:bg-[var(--secondary)] transition-all mt-4 shadow-lg shadow-emerald-900/10">Save Changes</button>
                        </div>
                    </Modal>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>                                     <img src={profileImage} alt="Profile" className="w-full h-full object-cover" />
                                        ) : (
                                            profileData.name.charAt(0)
                                        )}
                                    </div>
                                    <input type="file" ref={fileInputRef} onChange={handleImageUpload} className="hidden" accept="image/*" />
                                    <button onClick={() => fileInputRef.current.click()} className="absolute bottom-0 right-0 p-2 bg-slate-800 text-white rounded-full shadow-md hover:bg-slate-700"><ImageIcon size={14}/></button>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
                                <input type="text" value={profileData.name} onChange={(e) => setProfileData({...profileData, name: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Email</label>
                                <input type="email" value={profileData.email} onChange={(e) => setProfileData({...profileData, email: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Bio / Title</label>
                                <input type="text" value={profileData.bio} onChange={(e) => setProfileData({...profileData, bio: e.target.value})} className="w-full px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/50" />
                            </div>
                            <button onClick={() => setIsEditProfileModalOpen(false)} className="w-full bg-[var(--primary)] text-white py-3 rounded-xl font-bold hover:bg-[var(--secondary)] transition-all mt-4 shadow-lg shadow-emerald-900/10">Save Changes</button>
                        </div>
                    </Modal>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>